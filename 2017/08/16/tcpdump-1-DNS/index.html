<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>tcpdump(1) DNS | Ankai Liang's Blog</title><noscript>Please enable JavaScript to view the site</noscript><link rel="icon" href="/img/pwa/favicon.png"><!-- index.css--><link rel="stylesheet" href="/css/index.css?v=1.7.8"><!-- inject head--><link rel="stylesheet" href="https://cdn2.codesign.qq.com/icons/7pOrz0WXB5ZWJPX/latest/iconfont.css"><!-- aplayer--><!-- swiper--><!-- Open Graph--><meta name="description" content="CS615 Assignment4"><!-- pwa--><script>(win => {
        win.saveToLocal = {
            set: function setWithExpiry(key, value, ttl) {
                if (ttl === 0)
                    return
                const now = new Date()
                const expiryDay = ttl * 86400000
                const item = {
                    value: value,
                    expiry: now.getTime() + expiryDay,
                }
                localStorage.setItem(key, JSON.stringify(item))
            },

            get: function getWithExpiry(key) {
                const itemStr = localStorage.getItem(key)

                if (!itemStr) {
                    return undefined
                }
                const item = JSON.parse(itemStr)
                const now = new Date()

                if (now.getTime() > item.expiry) {
                    localStorage.removeItem(key)
                    return undefined
                }
                return item.value
            }
        }

        const DarkModeStatus = localStorage.getItem('theme')
        if (DarkModeStatus !== null) {
            if (DarkModeStatus === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark')
            } else {
                document.documentElement.setAttribute('data-theme', 'light')
            }
        }

        const asideStatus = saveToLocal.get('aside-status')
        if (asideStatus !== undefined) {
            if (asideStatus === 'hide') {
                document.documentElement.classList.add('hide-aside')
            } else {
                document.documentElement.classList.remove('hide-aside')
            }
        }

        win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
            const link = document.createElement('link')
            link.rel = 'stylesheet'
            link.href = url
            if (id) link.id = id
            link.onerror = reject
            link.onload = link.onreadystatechange = function () {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                link.onload = link.onreadystatechange = null
                resolve()
            }
            document.head.appendChild(link)
        })

        win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
            const script = document.createElement('script')
            script.src = url
            script.async = true
            script.onerror = reject
            script.onload = script.onreadystatechange = function () {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                script.onload = script.onreadystatechange = null
                resolve()
            }

            Object.keys(attr).forEach(key => {
                script.setAttribute(key, attr[key])
            })

            document.head.appendChild(script)
        })
    }
)(window)

console.log(
    "%c Program: Hexo %c Theme: Solitude %c Version: v1.7.8",
    "border-radius:5px 0 0 5px;padding: 5px 10px;color:white;background:#ff3842;",
    "padding: 5px 10px;color:white;background:#3e9f50;",
    "border-radius:0 5px 5px 0;padding: 5px 10px;background:#0084ff;color:white;"
);</script><!-- global head--><script>const GLOBAL_CONFIG = {
    root: '/',
    algolia: undefined,
    localsearch: undefined,
    runtime: '2023-04-20 00:00:00',
    lazyload: {
        enable: false,
        error: '/img/error_load.png'
    },
    copyright: false,
    highlight: {
        enable: true,
        limit: 200,
        expand: true,
        copy: true,
        syntax: 'highlight.js'
    },
    randomlink: false,
    lang: {"theme":{"dark":"dark","light":"light"},"copy":{"success":"Copied","error":"Copied failed"},"backtop":"Back to top","time":{"day":" days ago","hour":" hours ago","just":"just","min":" minutes ago","month":" months ago"},"f12":"Developer mode is turned on, please follow the GPL."},
    aside: {
        sayhello: {
            morning: 'The plan for the day lies in the morning.',
            noon: 'Only when you've eaten your fill do you have the energy to work.',
            afternoon: 'Concentrate your energy and overcome difficulties.',
            night: 'Don't tire yourself out too much; early sleep is healthier.',
            goodnight: 'Have a good sleep to ensure abundant energy.',
        },
        sayhello2: [],
    },
    covercolor: {
        enable: false
    },
    comment: {"avatar":"https://cravatar.cn","url":"https://waline-comment-b9nz6bbxt-ankailiangs-projects.vercel.app/","commentBarrage":true,"owo":{"body":".wl-emoji-popup","item":".wl-tab-wrapper button"}},
    lightbox: 'null',
    post_ai: {"key":null,"talk":null,"randomPost":false}
};</script><meta name="generator" content="Hexo 7.1.1"></head><body id="body"><!-- universe--><canvas id="universe"></canvas><!-- loading--><!-- console--><div id="console"><div class="close-btn" onclick="sco.hideConsole()"><i class="solitude st-close-fill"></i></div><div class="button-group"><div class="console-btn-item"><span class="darkmode_switchbutton" onclick="sco.switchDarkMode()" title="Day and night switching"><i class="solitude st-moon-clear-fill"></i></span></div><div class="console-btn-item" id="consoleHideAside"><span class="asideSwitch" onclick="sco.switchHideAside()" title="Sidebar display control"><i class="solitude st-side-bar-fill"></i></span></div></div><div class="console-mask" onclick="sco.hideConsole()"></div></div><!-- sidebar--><div id="sidebar" style="zoom: 1;"><div id="menu-mask" style="display: none;"></div><div id="sidebar-menus"><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Archives</div><div class="length-num">10</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">4</div></a></div></div></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><span class="darkmode_switchbutton menu-child" onclick="sco.switchDarkMode()"><i class="solitude st-moon-clear-fill"></i><span>Display mode</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span>Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>Articals</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="solitude  st-folder-fill"></i><span>Artical List</span></a></li><li><a class="site-page child" href="/tags/"><i class="solitude  st-price-tag-fill"></i><span>All tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>About</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="solitude  st-contacts-fill"></i><span>About</span></a></li></ul></div></div><span class="sidebar-menu-item-title">Tags</span><div class="card-widget card-tags card-archives card-webinfo card-allinfo"><div class="card-tag-cloud"><a href="/tags/Distrubute-System/">Distrubute System<sup>2</sup></a><a href="/tags/System-Administration/">System Administration<sup>6</sup></a><a href="/tags/AI/">AI<sup>1</sup></a><a href="/tags/Search-Infra/">Search Infra<sup>1</sup></a></div></div></div></div><!-- keyboard--><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav class="show" id="nav"><div id="nav-group"><div id="blog_name"><a id="site-name" href="/" title="Back to home"><span class="title">Ankai Liang / ex-Googler / ByteDancer</span></a></div><div id="page-name-mask"><div id="page-name"><a id="page-name-text" onclick="sco.toTop()">tcpdump(1) DNS</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span>Home</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>Articals</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="solitude  st-folder-fill"></i><span>Artical List</span></a></li><li><a class="site-page child" href="/tags/"><i class="solitude  st-price-tag-fill"></i><span>All tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>About</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="solitude  st-contacts-fill"></i><span>About</span></a></li></ul></div></div></div><div id="nav-left"></div><div id="nav-right"><div class="nav-button" id="nav-totop" onclick="sco.toTop()"><a class="totopbtn"><i class="solitude st-arrow-up-line"></i><span id="percent">0</span></a></div><div id="toggle-menu"><a class="site-page"><i class="solitude st-menu-line"></i></a></div></div></div></nav><div class="coverdiv" id="coverdiv"><img class="nolazyload" id="post-cover" src="/img/default.png" alt="tcpdump(1) DNS"></div><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original" title="This article is a Original article, pay attention to the copyright.">Original</a><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/System-Administration/"><span class="tags-name tags-punctuation">System Administration</span></a></div></div></div></div><h1 class="post-title">tcpdump(1) DNS</h1><div id="post-meta"><div class="meta-secondline"></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><div class="post-ai"><div class="ai-title"><div class="ai-title-left"><i class="ai-title-icon solitude st-robot-fill"></i><div class="ai-title-text">文章摘要</div></div><div class="ai-tag" id="ai-tag">GPT 4</div></div><div class="ai-explanation" style="display: block;"></div><div class="ai-suggestions"></div><div class="ai-bottom"><div class="ai-tips"></div><a class="ai-report" title="投诉" target="_blank" rel="noopener" href="https://efu.me/">投诉</a></div></div><article class="post-content" id="article-container"><span id="more"></span>

<h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><ul>
<li>link: <a target="_blank" rel="noopener" href="http://www.cs.stevens.edu/~jschauma/615/s17-hw4.html">http://www.cs.stevens.edu/~jschauma/615/s17-hw4.html</a></li>
</ul>
<h2 id="Objective"><a href="#Objective" class="headerlink" title="Objective"></a>Objective</h2><p>The objective of this assignment is for you to learn how to use tcpdump to observe and analyze network traffic. This reinforces lessons from our lecture on networking and prepares you for our lecture on the DNS.</p>
<p>In order to be able to observe DNS traffic flowing between your host and the DNS root servers as well as other DNS servers, you will need to set up and configure a simple caching name server, aka a resolver.</p>
<p>Note: you must use tcpdump. Graphical helper applications such as “wireshark” or similar tools are explicitly prohibited. You need to be able to read the flat text tcpdump output yourself and not rely on other tools to highlight things for you.</p>
<h2 id="OS-Instances"><a href="#OS-Instances" class="headerlink" title="OS Instances"></a>OS Instances</h2><p>The exercises below can be done on any OS instance you like. You will need at least two OS instances, one for the DNS server and one for the “client”. Make sure that the firewall rules between the server and client allow for all the required traffic.</p>
<h3 id="DNS-server-setup"><a href="#DNS-server-setup" class="headerlink" title="DNS server setup"></a>DNS server setup</h3><p>Set up a caching only DNS server (a &#96;&#96;resolver’’) on your OS instance. You may consult any online documentation available, such as this document or any others you prefer. You may use bind or any other DNS server software you like. The only restriction is that in the end your host must be able to function as a caching DNS server.</p>
<p>Set up your client host to use your newly created DNS server for host lookups.</p>
<p>tcpdump exercises</p>
<p>Use the tcpdump utility to monitor the network traffic using the following scenarios:</p>
<p>on the DNS server, run the following commands:<br>$ telnet <a target="_blank" rel="noopener" href="http://www.yahoo.com/">www.yahoo.com</a> 80<br>GET &#x2F; HTTP&#x2F;1.1<br>Host: <a target="_blank" rel="noopener" href="http://www.yahoo.com/">www.yahoo.com</a></p>
<p>Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Yahoo’s authoritative DNS servers.<br>Identify the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver, the packets that are being sent back and forth and finally the closing of the connection.</p>
<p>on your client host, run the following commands:<br>$ telnet <a target="_blank" rel="noopener" href="http://www.tumblr.com/">www.tumblr.com</a> 80<br>GET &#x2F; HTTP&#x2F;1.0</p>
<p>On your client: Track down the packets in your tcpdump referring to the DNS query from your client host to your DNS server.<br>On your DNS server: Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Tumblr’s authoritative DNS servers.</p>
<p>on the DNS server, perform a reverse host lookup (PTR) for a record not yet in your DNS server’s cache; track down in your tcpdump all relevant DNS queries required to retrieve the result. Clearly identify which name servers you are communicating with and who operates them.</p>
<hr>
<h1 id="Content"><a href="#Content" class="headerlink" title="Content"></a>Content</h1><h2 id="Set-up-a-caching-name-server"><a href="#Set-up-a-caching-name-server" class="headerlink" title="Set up a caching name server"></a>Set up a caching name server</h2><p>I read some tutorials and decide to set uo my name server in Red Hats OS.<br>tutorals:<br><a target="_blank" rel="noopener" href="http://www.tecmint.com/install-configure-cache-only-dns-server-in-rhel-centos-7/">http://www.tecmint.com/install-configure-cache-only-dns-server-in-rhel-centos-7/</a><br><a target="_blank" rel="noopener" href="http://www.tldp.org/HOWTO/DNS-HOWTO-3.html">http://www.tldp.org/HOWTO/DNS-HOWTO-3.html</a></p>
<h2 id="Create-a-instance-of-Red-Hat"><a href="#Create-a-instance-of-Red-Hat" class="headerlink" title="Create a instance of Red Hat."></a>Create a instance of Red Hat.</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ git:(master) ✗ aws ec2 run-instances --image-id ami-b63769a1 --count 1 --instance-type t2.micro --key-name keypair3 --security-groups mysg</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;OwnerId&quot;</span>: <span class="string">&quot;624990436890&quot;</span>, </span><br><span class="line">    <span class="string">&quot;ReservationId&quot;</span>: <span class="string">&quot;r-003997252666b66c6&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Groups&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;Instances&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;Monitoring&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;State&quot;</span>: <span class="string">&quot;disabled&quot;</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="string">&quot;PublicDnsName&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">            <span class="string">&quot;RootDeviceType&quot;</span>: <span class="string">&quot;ebs&quot;</span>, </span><br><span class="line">            <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Code&quot;</span>: 0, </span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;pending&quot;</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="string">&quot;EbsOptimized&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">            <span class="string">&quot;LaunchTime&quot;</span>: <span class="string">&quot;2017-03-18T22:23:48.000Z&quot;</span>, </span><br><span class="line">            <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.30.115&quot;</span>, </span><br><span class="line">            <span class="string">&quot;ProductCodes&quot;</span>: [], </span><br><span class="line">            <span class="string">&quot;VpcId&quot;</span>: <span class="string">&quot;vpc-adb325cb&quot;</span>, </span><br><span class="line">            <span class="string">&quot;StateTransitionReason&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">            <span class="string">&quot;InstanceId&quot;</span>: <span class="string">&quot;i-0c7d5c4b3a4726bd7&quot;</span>, </span><br><span class="line">            <span class="string">&quot;ImageId&quot;</span>: <span class="string">&quot;ami-b63769a1&quot;</span>, </span><br><span class="line">            <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-30-115.ec2.internal&quot;</span>, </span><br><span class="line">            <span class="string">&quot;KeyName&quot;</span>: <span class="string">&quot;keypair3&quot;</span>, </span><br><span class="line">            <span class="string">&quot;SecurityGroups&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;mysg&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;GroupId&quot;</span>: <span class="string">&quot;sg-a364e4df&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ], </span><br><span class="line">            <span class="string">&quot;ClientToken&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">            <span class="string">&quot;SubnetId&quot;</span>: <span class="string">&quot;subnet-09dda752&quot;</span>, </span><br><span class="line">            <span class="string">&quot;InstanceType&quot;</span>: <span class="string">&quot;t2.micro&quot;</span>, </span><br><span class="line">            <span class="string">&quot;NetworkInterfaces&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;in-use&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;0e:db:b6:0f:70:54&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;SourceDestCheck&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                    <span class="string">&quot;VpcId&quot;</span>: <span class="string">&quot;vpc-adb325cb&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;Description&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;NetworkInterfaceId&quot;</span>: <span class="string">&quot;eni-423bf184&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PrivateIpAddresses&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-30-115.ec2.internal&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Primary&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                            <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.30.115&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-30-115.ec2.internal&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;Attachment&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;attaching&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;DeviceIndex&quot;</span>: 0, </span><br><span class="line">                        <span class="string">&quot;DeleteOnTermination&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                        <span class="string">&quot;AttachmentId&quot;</span>: <span class="string">&quot;eni-attach-dcda6e8c&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;AttachTime&quot;</span>: <span class="string">&quot;2017-03-18T22:23:48.000Z&quot;</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="string">&quot;Groups&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;mysg&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;GroupId&quot;</span>: <span class="string">&quot;sg-a364e4df&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;Ipv6Addresses&quot;</span>: [], </span><br><span class="line">                    <span class="string">&quot;SubnetId&quot;</span>: <span class="string">&quot;subnet-09dda752&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;OwnerId&quot;</span>: <span class="string">&quot;624990436890&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.30.115&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ], </span><br><span class="line">            <span class="string">&quot;SourceDestCheck&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">            <span class="string">&quot;Placement&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Tenancy&quot;</span>: <span class="string">&quot;default&quot;</span>, </span><br><span class="line">                <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                <span class="string">&quot;AvailabilityZone&quot;</span>: <span class="string">&quot;us-east-1b&quot;</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="string">&quot;Hypervisor&quot;</span>: <span class="string">&quot;xen&quot;</span>, </span><br><span class="line">            <span class="string">&quot;BlockDeviceMappings&quot;</span>: [], </span><br><span class="line">            <span class="string">&quot;Architecture&quot;</span>: <span class="string">&quot;x86_64&quot;</span>, </span><br><span class="line">            <span class="string">&quot;StateReason&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Message&quot;</span>: <span class="string">&quot;pending&quot;</span>, </span><br><span class="line">                <span class="string">&quot;Code&quot;</span>: <span class="string">&quot;pending&quot;</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="string">&quot;RootDeviceName&quot;</span>: <span class="string">&quot;/dev/sda1&quot;</span>, </span><br><span class="line">            <span class="string">&quot;VirtualizationType&quot;</span>: <span class="string">&quot;hvm&quot;</span>, </span><br><span class="line">            <span class="string">&quot;AmiLaunchIndex&quot;</span>: 0</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">➜  ~ git:(master) ✗ aws ec2 describe-instances --filters <span class="string">&quot;Name=image-id,Values=ami-b63769a1&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Reservations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;OwnerId&quot;</span>: <span class="string">&quot;624990436890&quot;</span>, </span><br><span class="line">            <span class="string">&quot;ReservationId&quot;</span>: <span class="string">&quot;r-003997252666b66c6&quot;</span>, </span><br><span class="line">            <span class="string">&quot;Groups&quot;</span>: [], </span><br><span class="line">            <span class="string">&quot;Instances&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Monitoring&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;State&quot;</span>: <span class="string">&quot;disabled&quot;</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="string">&quot;PublicDnsName&quot;</span>: <span class="string">&quot;ec2-54-91-19-43.compute-1.amazonaws.com&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;Code&quot;</span>: 16, </span><br><span class="line">                        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;running&quot;</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="string">&quot;EbsOptimized&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">                    <span class="string">&quot;LaunchTime&quot;</span>: <span class="string">&quot;2017-03-18T22:23:48.000Z&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PublicIpAddress&quot;</span>: <span class="string">&quot;54.91.19.43&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.30.115&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;ProductCodes&quot;</span>: [], </span><br><span class="line">                    <span class="string">&quot;VpcId&quot;</span>: <span class="string">&quot;vpc-adb325cb&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;StateTransitionReason&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;InstanceId&quot;</span>: <span class="string">&quot;i-0c7d5c4b3a4726bd7&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;ImageId&quot;</span>: <span class="string">&quot;ami-b63769a1&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-30-115.ec2.internal&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;KeyName&quot;</span>: <span class="string">&quot;keypair3&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;SecurityGroups&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;mysg&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;GroupId&quot;</span>: <span class="string">&quot;sg-a364e4df&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;ClientToken&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;SubnetId&quot;</span>: <span class="string">&quot;subnet-09dda752&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;InstanceType&quot;</span>: <span class="string">&quot;t2.micro&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;NetworkInterfaces&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;in-use&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;0e:db:b6:0f:70:54&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;SourceDestCheck&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                            <span class="string">&quot;VpcId&quot;</span>: <span class="string">&quot;vpc-adb325cb&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Description&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Association&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;PublicIp&quot;</span>: <span class="string">&quot;54.91.19.43&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;PublicDnsName&quot;</span>: <span class="string">&quot;ec2-54-91-19-43.compute-1.amazonaws.com&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;IpOwnerId&quot;</span>: <span class="string">&quot;amazon&quot;</span></span><br><span class="line">                            &#125;, </span><br><span class="line">                            <span class="string">&quot;NetworkInterfaceId&quot;</span>: <span class="string">&quot;eni-423bf184&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;PrivateIpAddresses&quot;</span>: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-30-115.ec2.internal&quot;</span>, </span><br><span class="line">                                    <span class="string">&quot;Association&quot;</span>: &#123;</span><br><span class="line">                                        <span class="string">&quot;PublicIp&quot;</span>: <span class="string">&quot;54.91.19.43&quot;</span>, </span><br><span class="line">                                        <span class="string">&quot;PublicDnsName&quot;</span>: <span class="string">&quot;ec2-54-91-19-43.compute-1.amazonaws.com&quot;</span>, </span><br><span class="line">                                        <span class="string">&quot;IpOwnerId&quot;</span>: <span class="string">&quot;amazon&quot;</span></span><br><span class="line">                                    &#125;, </span><br><span class="line">                                    <span class="string">&quot;Primary&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                                    <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.30.115&quot;</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            ], </span><br><span class="line">                            <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-30-115.ec2.internal&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Attachment&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;attached&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;DeviceIndex&quot;</span>: 0, </span><br><span class="line">                                <span class="string">&quot;DeleteOnTermination&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                                <span class="string">&quot;AttachmentId&quot;</span>: <span class="string">&quot;eni-attach-dcda6e8c&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;AttachTime&quot;</span>: <span class="string">&quot;2017-03-18T22:23:48.000Z&quot;</span></span><br><span class="line">                            &#125;, </span><br><span class="line">                            <span class="string">&quot;Groups&quot;</span>: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;mysg&quot;</span>, </span><br><span class="line">                                    <span class="string">&quot;GroupId&quot;</span>: <span class="string">&quot;sg-a364e4df&quot;</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            ], </span><br><span class="line">                            <span class="string">&quot;Ipv6Addresses&quot;</span>: [], </span><br><span class="line">                            <span class="string">&quot;SubnetId&quot;</span>: <span class="string">&quot;subnet-09dda752&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;OwnerId&quot;</span>: <span class="string">&quot;624990436890&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.30.115&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;SourceDestCheck&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                    <span class="string">&quot;Placement&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;Tenancy&quot;</span>: <span class="string">&quot;default&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;AvailabilityZone&quot;</span>: <span class="string">&quot;us-east-1b&quot;</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="string">&quot;Hypervisor&quot;</span>: <span class="string">&quot;xen&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;BlockDeviceMappings&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;DeviceName&quot;</span>: <span class="string">&quot;/dev/sda1&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Ebs&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;attached&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;DeleteOnTermination&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                                <span class="string">&quot;VolumeId&quot;</span>: <span class="string">&quot;vol-0e34a21597e2a21f6&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;AttachTime&quot;</span>: <span class="string">&quot;2017-03-18T22:23:49.000Z&quot;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;Architecture&quot;</span>: <span class="string">&quot;x86_64&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;RootDeviceType&quot;</span>: <span class="string">&quot;ebs&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;RootDeviceName&quot;</span>: <span class="string">&quot;/dev/sda1&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;VirtualizationType&quot;</span>: <span class="string">&quot;hvm&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;AmiLaunchIndex&quot;</span>: 0</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Install-package-bind-bind-utils-and-caching-nameserver"><a href="#Install-package-bind-bind-utils-and-caching-nameserver" class="headerlink" title="Install package bind, bind-utils and caching-nameserver."></a>Install package <code>bind</code>, <code>bind-utils</code> and <code>caching-nameserver</code>.</h2><p>Public DNS: ec2-54-91-19-43.compute-1.amazonaws.com</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">➜  Documents git:(master) ✗ ssh -i p.pem ec2-user@ec2-54-91-19-43.compute-1.amazonaws.com</span><br><span class="line">[ec2-user@ip-172-31-30-115 ~]$ </span><br><span class="line">[ec2-user@ip-172-31-30-115 ~]$ yum install <span class="built_in">bind</span></span><br><span class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</span><br><span class="line">Repo rhui-REGION-client-config-server-7 forced skip_if_unavailable=True due to: /etc/pki/rhui/cdn.redhat.com-chain.crt</span><br><span class="line">Repo rhui-REGION-client-config-server-7 forced skip_if_unavailable=True due to: /etc/pki/rhui/product/rhui-client-config-server-7.crt</span><br><span class="line">Repo rhui-REGION-client-config-server-7 forced skip_if_unavailable=True due to: /etc/pki/rhui/rhui-client-config-server-7.key</span><br><span class="line">Repo rhui-REGION-rhel-server-releases forced skip_if_unavailable=True due to: /etc/pki/rhui/cdn.redhat.com-chain.crt</span><br><span class="line">Repo rhui-REGION-rhel-server-releases forced skip_if_unavailable=True due to: /etc/pki/rhui/product/content-rhel7.crt</span><br><span class="line">Repo rhui-REGION-rhel-server-releases forced skip_if_unavailable=True due to: /etc/pki/rhui/content-rhel7.key</span><br><span class="line">Repo rhui-REGION-rhel-server-rh-common forced skip_if_unavailable=True due to: /etc/pki/rhui/cdn.redhat.com-chain.crt</span><br><span class="line">Repo rhui-REGION-rhel-server-rh-common forced skip_if_unavailable=True due to: /etc/pki/rhui/product/content-rhel7.crt</span><br><span class="line">Repo rhui-REGION-rhel-server-rh-common forced skip_if_unavailable=True due to: /etc/pki/rhui/content-rhel7.key</span><br><span class="line">You need to be root to perform this <span class="built_in">command</span>.</span><br><span class="line">[ec2-user@ip-172-31-30-115 ~]$ sudo yum install <span class="built_in">bind</span></span><br><span class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</span><br><span class="line">rhui-REGION-client-config-server-7                       | 2.9 kB     00:00     </span><br><span class="line">rhui-REGION-rhel-server-releases                         | 3.5 kB     00:00     </span><br><span class="line">rhui-REGION-rhel-server-rh-common                        | 3.8 kB     00:00     </span><br><span class="line">(1/7): rhui-REGION-client-config-server-7/x86_64/primary_d | 5.5 kB   00:00     </span><br><span class="line">(2/7): rhui-REGION-rhel-server-rh-common/7Server/x86_64/gr |  104 B   00:00     </span><br><span class="line">(3/7): rhui-REGION-rhel-server-releases/7Server/x86_64/gro | 701 kB   00:00     </span><br><span class="line">(4/7): rhui-REGION-rhel-server-releases/7Server/x86_64/upd | 1.8 MB   00:00     </span><br><span class="line">(5/7): rhui-REGION-rhel-server-rh-common/7Server/x86_64/up |  30 kB   00:00     </span><br><span class="line">(6/7): rhui-REGION-rhel-server-rh-common/7Server/x86_64/pr | 112 kB   00:00     </span><br><span class="line">(7/7): rhui-REGION-rhel-server-releases/7Server/x86_64/pri |  34 MB   00:01     </span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package bind.x86_64 32:9.9.4-38.el7_3.2 will be installed</span><br><span class="line">--&gt; Processing Dependency: bind-libs = 32:9.9.4-38.el7_3.2 <span class="keyword">for</span> package: 32:bind-9.9.4-38.el7_3.2.x86_64</span><br><span class="line">--&gt; Processing Dependency: libbind9.so.90()(64bit) <span class="keyword">for</span> package: 32:bind-9.9.4-38.el7_3.2.x86_64</span><br><span class="line">--&gt; Processing Dependency: libdns.so.100()(64bit) <span class="keyword">for</span> package: 32:bind-9.9.4-38.el7_3.2.x86_64</span><br><span class="line">--&gt; Processing Dependency: libisc.so.95()(64bit) <span class="keyword">for</span> package: 32:bind-9.9.4-38.el7_3.2.x86_64</span><br><span class="line">--&gt; Processing Dependency: libisccc.so.90()(64bit) <span class="keyword">for</span> package: 32:bind-9.9.4-38.el7_3.2.x86_64</span><br><span class="line">--&gt; Processing Dependency: libisccfg.so.90()(64bit) <span class="keyword">for</span> package: 32:bind-9.9.4-38.el7_3.2.x86_64</span><br><span class="line">--&gt; Processing Dependency: liblwres.so.90()(64bit) <span class="keyword">for</span> package: 32:bind-9.9.4-38.el7_3.2.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package bind-libs.x86_64 32:9.9.4-38.el7_3.2 will be installed</span><br><span class="line">--&gt; Processing Dependency: bind-license = 32:9.9.4-38.el7_3.2 <span class="keyword">for</span> package: 32:bind-libs-9.9.4-38.el7_3.2.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package bind-license.noarch 32:9.9.4-37.el7 will be updated</span><br><span class="line">--&gt; Processing Dependency: bind-license = 32:9.9.4-37.el7 <span class="keyword">for</span> package: 32:bind-libs-lite-9.9.4-37.el7.x86_64</span><br><span class="line">---&gt; Package bind-license.noarch 32:9.9.4-38.el7_3.2 will be an update</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package bind-libs-lite.x86_64 32:9.9.4-37.el7 will be updated</span><br><span class="line">---&gt; Package bind-libs-lite.x86_64 32:9.9.4-38.el7_3.2 will be an update</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> Package      Arch   Version             Repository                        Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> <span class="built_in">bind</span>         x86_64 32:9.9.4-38.el7_3.2 rhui-REGION-rhel-server-releases 1.8 M</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> bind-libs    x86_64 32:9.9.4-38.el7_3.2 rhui-REGION-rhel-server-releases 1.0 M</span><br><span class="line">Updating <span class="keyword">for</span> dependencies:</span><br><span class="line"> bind-libs-lite</span><br><span class="line">              x86_64 32:9.9.4-38.el7_3.2 rhui-REGION-rhel-server-releases 730 k</span><br><span class="line"> bind-license noarch 32:9.9.4-38.el7_3.2 rhui-REGION-rhel-server-releases  83 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package  (+1 Dependent package)</span><br><span class="line">Upgrade             ( 2 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 3.6 M</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">Delta RPMs disabled because /usr/bin/applydeltarpm not installed.</span><br><span class="line">(1/4): bind-libs-9.9.4-38.el7_3.2.x86_64.rpm               | 1.0 MB   00:00     </span><br><span class="line">(2/4): bind-9.9.4-38.el7_3.2.x86_64.rpm                    | 1.8 MB   00:00     </span><br><span class="line">(3/4): bind-libs-lite-9.9.4-38.el7_3.2.x86_64.rpm          | 730 kB   00:00     </span><br><span class="line">(4/4): bind-license-9.9.4-38.el7_3.2.noarch.rpm            |  83 kB   00:00     </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                              7.4 MB/s | 3.6 MB  00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Updating   : 32:bind-license-9.9.4-38.el7_3.2.noarch                      1/6 </span><br><span class="line">  Installing : 32:bind-libs-9.9.4-38.el7_3.2.x86_64                         2/6 </span><br><span class="line">  Installing : 32:bind-9.9.4-38.el7_3.2.x86_64                              3/6 </span><br><span class="line">  Updating   : 32:bind-libs-lite-9.9.4-38.el7_3.2.x86_64                    4/6 </span><br><span class="line">  Cleanup    : 32:bind-libs-lite-9.9.4-37.el7.x86_64                        5/6 </span><br><span class="line">  Cleanup    : 32:bind-license-9.9.4-37.el7.noarch                          6/6 </span><br><span class="line">  Verifying  : 32:bind-9.9.4-38.el7_3.2.x86_64                              1/6 </span><br><span class="line">  Verifying  : 32:bind-libs-lite-9.9.4-38.el7_3.2.x86_64                    2/6 </span><br><span class="line">  Verifying  : 32:bind-libs-9.9.4-38.el7_3.2.x86_64                         3/6 </span><br><span class="line">  Verifying  : 32:bind-license-9.9.4-38.el7_3.2.noarch                      4/6 </span><br><span class="line">  Verifying  : 32:bind-libs-lite-9.9.4-37.el7.x86_64                        5/6 </span><br><span class="line">  Verifying  : 32:bind-license-9.9.4-37.el7.noarch                          6/6 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  bind.x86_64 32:9.9.4-38.el7_3.2                                               </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  bind-libs.x86_64 32:9.9.4-38.el7_3.2                                          </span><br><span class="line"></span><br><span class="line">Dependency Updated:</span><br><span class="line">  bind-libs-lite.x86_64 32:9.9.4-38.el7_3.2                                     </span><br><span class="line">  bind-license.noarch 32:9.9.4-38.el7_3.2                                       </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[ec2-user@ip-172-31-30-115 ~]$ sudo yum install bind-utils</span><br><span class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package bind-utils.x86_64 32:9.9.4-38.el7_3.2 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> Package    Arch   Version               Repository                        Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> bind-utils x86_64 32:9.9.4-38.el7_3.2   rhui-REGION-rhel-server-releases 202 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 202 k</span><br><span class="line">Installed size: 434 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">bind-utils-9.9.4-38.el7_3.2.x86_64.rpm                     | 202 kB   00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : 32:bind-utils-9.9.4-38.el7_3.2.x86_64                        1/1 </span><br><span class="line">  Verifying  : 32:bind-utils-9.9.4-38.el7_3.2.x86_64                        1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  bind-utils.x86_64 32:9.9.4-38.el7_3.2                                         </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[ec2-user@ip-172-31-30-115 ~]$ sudo yum install caching-nameserver</span><br><span class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</span><br><span class="line">Package 32:bind-9.9.4-38.el7_3.2.x86_64 already installed and latest version</span><br><span class="line">Nothing to <span class="keyword">do</span></span><br></pre></td></tr></table></figure>

<h2 id="Modify-the-file-‘-etc-named-conf’"><a href="#Modify-the-file-‘-etc-named-conf’" class="headerlink" title="Modify the file ‘&#x2F;etc&#x2F;named.conf’"></a>Modify the file ‘&#x2F;etc&#x2F;named.conf’</h2><p>Then I look the file <code>/etc/named.conf</code>:<br>This file has limit of permission. I use root as user.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-30-115 var]$ sudo su</span><br><span class="line">[root@ip-172-31-30-115 etc]<span class="comment"># vi named.conf </span></span><br></pre></td></tr></table></figure>

<p>Modify:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// named.conf</span><br><span class="line">//</span><br><span class="line">// Provided by Red Hat <span class="built_in">bind</span> package to configure the ISC BIND named(8) DNS</span><br><span class="line">// server as a caching only nameserver (as a localhost DNS resolver only).</span><br><span class="line">//</span><br><span class="line">// See /usr/share/doc/bind*/sample/ <span class="keyword">for</span> example named configuration files.</span><br><span class="line">//</span><br><span class="line">// See the BIND Administrator<span class="string">&#x27;s Reference Manual (ARM) for details about the</span></span><br><span class="line"><span class="string">// configuration located in /usr/share/doc/bind-&#123;version&#125;/Bv9ARM.html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">options &#123;</span></span><br><span class="line"><span class="string">        listen-on port 53 &#123; 127.0.0.1; any; &#125;;</span></span><br><span class="line"><span class="string">        listen-on-v6 port 53 &#123; ::1; &#125;;</span></span><br><span class="line"><span class="string">        directory       &quot;/var/named&quot;;</span></span><br><span class="line"><span class="string">        dump-file       &quot;/var/named/data/cache_dump.db&quot;;</span></span><br><span class="line"><span class="string">        statistics-file &quot;/var/named/data/named_stats.txt&quot;;</span></span><br><span class="line"><span class="string">        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;</span></span><br><span class="line"><span class="string">        allow-query     &#123; localhost; any; &#125;;</span></span><br><span class="line"><span class="string">        allow-query-cache &#123; localhost; any; &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        /*</span></span><br><span class="line"><span class="string">         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.</span></span><br><span class="line"><span class="string">         - If you are building a RECURSIVE (caching) DNS server, you need to enable recursion.</span></span><br><span class="line"><span class="string">         - If your recursive DNS server has a public IP address, you MUST enable access</span></span><br><span class="line"><span class="string">           control to limit queries to your legitimate users. Failing to do so will</span></span><br><span class="line"><span class="string">           cause your server to become part of large scale DNS amplification</span></span><br><span class="line"><span class="string">           attacks. Implementing BCP38 within your network would greatly</span></span><br><span class="line"><span class="string">           reduce such attack surface</span></span><br><span class="line"><span class="string">        */</span></span><br><span class="line"><span class="string">        recursion yes;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        dnssec-enable yes;</span></span><br><span class="line"><span class="string">        dnssec-validation yes;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        /* Path to ISC DLV key */</span></span><br><span class="line"><span class="string">        bindkeys-file &quot;/etc/named.iscdlv.key&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        managed-keys-directory &quot;/var/named/dynamic&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        pid-file &quot;/run/named/named.pid&quot;;</span></span><br><span class="line"><span class="string">        session-keyfile &quot;/run/named/session.key&quot;;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">logging &#123;</span></span><br><span class="line"><span class="string">        channel default_debug &#123;</span></span><br><span class="line"><span class="string">                file &quot;data/named.run&quot;;</span></span><br><span class="line"><span class="string">                severity dynamic;</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">zone &quot;.&quot; IN &#123;</span></span><br><span class="line"><span class="string">        type hint;</span></span><br><span class="line"><span class="string">        file &quot;named.ca&quot;;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">include &quot;/etc/named.rfc1912.zones&quot;;</span></span><br><span class="line"><span class="string">include &quot;/etc/named.root.key&quot;;</span></span><br></pre></td></tr></table></figure>

<h2 id="Look-the-file-‘named-ca’"><a href="#Look-the-file-‘named-ca’" class="headerlink" title="Look the file ‘named.ca’:"></a>Look the file ‘named.ca’:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 etc]<span class="comment"># vi /var/named/named.ca</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.2-P1-RedHat-9.9.2-6.P1.fc18 &lt;&lt;&gt;&gt; +bufsize=1200 +norec @a.root-servers.net</span><br><span class="line">; (2 servers found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 25828</span></span><br><span class="line"><span class="string">;; flags: qr aa; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 23</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 512</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;.                              IN      NS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      a.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      b.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      c.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      d.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      e.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      f.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      g.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      h.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      i.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      j.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      k.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      l.root-servers.net.</span></span><br><span class="line"><span class="string">.                       518400  IN      NS      m.root-servers.net.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ADDITIONAL SECTION:</span></span><br><span class="line"><span class="string">a.root-servers.net.     3600000 IN      A       198.41.0.4</span></span><br><span class="line"><span class="string">a.root-servers.net.     3600000 IN      AAAA    2001:503:ba3e::2:30</span></span><br><span class="line"><span class="string">b.root-servers.net.     3600000 IN      A       192.228.79.201</span></span><br><span class="line"><span class="string">c.root-servers.net.     3600000 IN      A       192.33.4.12</span></span><br><span class="line"><span class="string">d.root-servers.net.     3600000 IN      A       199.7.91.13</span></span><br><span class="line"><span class="string">d.root-servers.net.     3600000 IN      AAAA    2001:500:2d::d</span></span><br><span class="line"><span class="string">e.root-servers.net.     3600000 IN      A       192.203.230.10</span></span><br><span class="line"><span class="string">f.root-servers.net.     3600000 IN      A       192.5.5.241</span></span><br><span class="line"><span class="string">f.root-servers.net.     3600000 IN      AAAA    2001:500:2f::f</span></span><br><span class="line"><span class="string">g.root-servers.net.     3600000 IN      A       192.112.36.4</span></span><br><span class="line"><span class="string">h.root-servers.net.     3600000 IN      A       128.63.2.53</span></span><br><span class="line"><span class="string">h.root-servers.net.     3600000 IN      AAAA    2001:500:1::803f:235</span></span><br><span class="line"><span class="string">i.root-servers.net.     3600000 IN      A       192.36.148.17</span></span><br><span class="line"><span class="string">i.root-servers.net.     3600000 IN      AAAA    2001:7fe::53</span></span><br><span class="line"><span class="string">j.root-servers.net.     3600000 IN      A       192.58.128.30</span></span><br><span class="line"><span class="string">j.root-servers.net.     3600000 IN      AAAA    2001:503:c27::2:30</span></span><br><span class="line"><span class="string">k.root-servers.net.     3600000 IN      A       193.0.14.129</span></span><br><span class="line"><span class="string">k.root-servers.net.     3600000 IN      AAAA    2001:7fd::1</span></span><br><span class="line"><span class="string">l.root-servers.net.     3600000 IN      A       199.7.83.42</span></span><br><span class="line"><span class="string">l.root-servers.net.     3600000 IN      AAAA    2001:500:3::42</span></span><br><span class="line"><span class="string">m.root-servers.net.     3600000 IN      A       202.12.27.33</span></span><br><span class="line"><span class="string">m.root-servers.net.     3600000 IN      AAAA    2001:dc3::35</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 78 msec</span></span><br><span class="line"><span class="string">;; SERVER: 198.41.0.4#53(198.41.0.4)</span></span><br><span class="line"><span class="string">;; WHEN: Mon Jan 28 15:33:31 2013</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 699</span></span><br></pre></td></tr></table></figure>


<h2 id="Modify-the-file-‘etc-resolv-conf’"><a href="#Modify-the-file-‘etc-resolv-conf’" class="headerlink" title="Modify the file ‘etc&#x2F;resolv.conf’:"></a>Modify the file ‘etc&#x2F;resolv.conf’:</h2><p>The <code>nameserver&#39; line specifies the address of nameserver. The </code>search&#96; set the searching order of client request:<br>If a client tries to look up foo, then foo.subdomain.your-domain.edu is tried first, then foo.your-domain.edu, and finally foo. You may not want to put in too many domains in the search line, as it takes time to search them all.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">search subdomain.your-domain.edu your-domain.edu</span><br><span class="line">nameserver 127.0.0.1</span><br></pre></td></tr></table></figure>

<h2 id="Deploy-the-Cache-only-DNS-server-within-chroot-environment"><a href="#Deploy-the-Cache-only-DNS-server-within-chroot-environment" class="headerlink" title="Deploy the Cache-only DNS server within chroot environment"></a>Deploy the Cache-only DNS server within chroot environment</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install bind-chroot -y</span></span><br><span class="line"><span class="comment"># systemctl restart named</span></span><br><span class="line"><span class="comment"># ln -s /etc/named.conf /var/named/chroot/etc/named.conf</span></span><br></pre></td></tr></table></figure>

<h2 id="Start-the-named-server"><a href="#Start-the-named-server" class="headerlink" title="Start the named server"></a>Start the named server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 network-scripts]<span class="comment"># systemctl restart named</span></span><br><span class="line">[root@ip-172-31-30-115 network-scripts]<span class="comment"># systemctl enable named</span></span><br><span class="line">[root@ip-172-31-30-115 network-scripts]<span class="comment"># systemctl status named</span></span><br><span class="line">● named.service - Berkeley Internet Name Domain (DNS)</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/named.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sun 2017-03-19 01:09:45 EDT; 10s ago</span><br><span class="line"> Main PID: 17623 (named)</span><br><span class="line">   CGroup: /system.slice/named.service</span><br><span class="line">           └─17623 /usr/sbin/named -u named</span><br><span class="line"></span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: <span class="built_in">command</span> channel listening on ::1<span class="comment">#953</span></span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: managed-keys-zone: loaded serial 2</span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal systemd[1]: Started Berkeley Internet Name Domain (DNS).</span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone 0.in-addr.arpa/IN: loaded serial 0</span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone 1.0.0.127.in-addr.arpa/IN: loaded serial 0</span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0....ial 0</span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone localhost/IN: loaded serial 0</span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone localhost.localdomain/IN: loaded serial 0</span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: all zones loaded</span><br><span class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: running</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure>

<h2 id="Configured-the-client"><a href="#Configured-the-client" class="headerlink" title="Configured the client"></a>Configured the client</h2><h3 id="Create-an-instance-as-our-client"><a href="#Create-an-instance-as-our-client" class="headerlink" title="Create an instance as our client"></a>Create an instance as our client</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ git:(master) ✗ aws ec2 run-instances --image-id ami-b63769a1 --count 1 --instance-type t2.micro --key-name keypair3 --security-groups mysg</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;OwnerId&quot;</span>: <span class="string">&quot;624990436890&quot;</span>, </span><br><span class="line">    <span class="string">&quot;ReservationId&quot;</span>: <span class="string">&quot;r-07677d6d1f894a149&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Groups&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;Instances&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;Monitoring&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;State&quot;</span>: <span class="string">&quot;disabled&quot;</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="string">&quot;PublicDnsName&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">            <span class="string">&quot;RootDeviceType&quot;</span>: <span class="string">&quot;ebs&quot;</span>, </span><br><span class="line">            <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Code&quot;</span>: 0, </span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;pending&quot;</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="string">&quot;EbsOptimized&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">            <span class="string">&quot;LaunchTime&quot;</span>: <span class="string">&quot;2017-03-19T04:29:59.000Z&quot;</span>, </span><br><span class="line">            <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.23.114&quot;</span>, </span><br><span class="line">            <span class="string">&quot;ProductCodes&quot;</span>: [], </span><br><span class="line">            <span class="string">&quot;VpcId&quot;</span>: <span class="string">&quot;vpc-adb325cb&quot;</span>, </span><br><span class="line">            <span class="string">&quot;StateTransitionReason&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">            <span class="string">&quot;InstanceId&quot;</span>: <span class="string">&quot;i-077fb91e833447d9b&quot;</span>, </span><br><span class="line">            <span class="string">&quot;ImageId&quot;</span>: <span class="string">&quot;ami-b63769a1&quot;</span>, </span><br><span class="line">            <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-23-114.ec2.internal&quot;</span>, </span><br><span class="line">            <span class="string">&quot;KeyName&quot;</span>: <span class="string">&quot;keypair3&quot;</span>, </span><br><span class="line">            <span class="string">&quot;SecurityGroups&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;mysg&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;GroupId&quot;</span>: <span class="string">&quot;sg-a364e4df&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ], </span><br><span class="line">            <span class="string">&quot;ClientToken&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">            <span class="string">&quot;SubnetId&quot;</span>: <span class="string">&quot;subnet-09dda752&quot;</span>, </span><br><span class="line">            <span class="string">&quot;InstanceType&quot;</span>: <span class="string">&quot;t2.micro&quot;</span>, </span><br><span class="line">            <span class="string">&quot;NetworkInterfaces&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;in-use&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;0e:b4:86:cf:b2:78&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;SourceDestCheck&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                    <span class="string">&quot;VpcId&quot;</span>: <span class="string">&quot;vpc-adb325cb&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;Description&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;NetworkInterfaceId&quot;</span>: <span class="string">&quot;eni-00f324c6&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PrivateIpAddresses&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-23-114.ec2.internal&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Primary&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                            <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.23.114&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-23-114.ec2.internal&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;Attachment&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;attaching&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;DeviceIndex&quot;</span>: 0, </span><br><span class="line">                        <span class="string">&quot;DeleteOnTermination&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                        <span class="string">&quot;AttachmentId&quot;</span>: <span class="string">&quot;eni-attach-cb5aed9b&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;AttachTime&quot;</span>: <span class="string">&quot;2017-03-19T04:29:59.000Z&quot;</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="string">&quot;Groups&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;mysg&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;GroupId&quot;</span>: <span class="string">&quot;sg-a364e4df&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;Ipv6Addresses&quot;</span>: [], </span><br><span class="line">                    <span class="string">&quot;SubnetId&quot;</span>: <span class="string">&quot;subnet-09dda752&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;OwnerId&quot;</span>: <span class="string">&quot;624990436890&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.23.114&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ], </span><br><span class="line">            <span class="string">&quot;SourceDestCheck&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">            <span class="string">&quot;Placement&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Tenancy&quot;</span>: <span class="string">&quot;default&quot;</span>, </span><br><span class="line">                <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                <span class="string">&quot;AvailabilityZone&quot;</span>: <span class="string">&quot;us-east-1b&quot;</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="string">&quot;Hypervisor&quot;</span>: <span class="string">&quot;xen&quot;</span>, </span><br><span class="line">            <span class="string">&quot;BlockDeviceMappings&quot;</span>: [], </span><br><span class="line">            <span class="string">&quot;Architecture&quot;</span>: <span class="string">&quot;x86_64&quot;</span>, </span><br><span class="line">            <span class="string">&quot;StateReason&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Message&quot;</span>: <span class="string">&quot;pending&quot;</span>, </span><br><span class="line">                <span class="string">&quot;Code&quot;</span>: <span class="string">&quot;pending&quot;</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="string">&quot;RootDeviceName&quot;</span>: <span class="string">&quot;/dev/sda1&quot;</span>, </span><br><span class="line">            <span class="string">&quot;VirtualizationType&quot;</span>: <span class="string">&quot;hvm&quot;</span>, </span><br><span class="line">            <span class="string">&quot;AmiLaunchIndex&quot;</span>: 0</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">➜  ~ git:(master) ✗ aws ec2 describe-instances --filters <span class="string">&quot;Name=instance-id,Values=i-077fb91e833447d9b&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Reservations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;OwnerId&quot;</span>: <span class="string">&quot;624990436890&quot;</span>, </span><br><span class="line">            <span class="string">&quot;ReservationId&quot;</span>: <span class="string">&quot;r-07677d6d1f894a149&quot;</span>, </span><br><span class="line">            <span class="string">&quot;Groups&quot;</span>: [], </span><br><span class="line">            <span class="string">&quot;Instances&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Monitoring&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;State&quot;</span>: <span class="string">&quot;disabled&quot;</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="string">&quot;PublicDnsName&quot;</span>: <span class="string">&quot;ec2-54-242-90-155.compute-1.amazonaws.com&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;Code&quot;</span>: 16, </span><br><span class="line">                        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;running&quot;</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="string">&quot;EbsOptimized&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">                    <span class="string">&quot;LaunchTime&quot;</span>: <span class="string">&quot;2017-03-19T04:29:59.000Z&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PublicIpAddress&quot;</span>: <span class="string">&quot;54.242.90.155&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.23.114&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;ProductCodes&quot;</span>: [], </span><br><span class="line">                    <span class="string">&quot;VpcId&quot;</span>: <span class="string">&quot;vpc-adb325cb&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;StateTransitionReason&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;InstanceId&quot;</span>: <span class="string">&quot;i-077fb91e833447d9b&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;ImageId&quot;</span>: <span class="string">&quot;ami-b63769a1&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-23-114.ec2.internal&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;KeyName&quot;</span>: <span class="string">&quot;keypair3&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;SecurityGroups&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;mysg&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;GroupId&quot;</span>: <span class="string">&quot;sg-a364e4df&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;ClientToken&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;SubnetId&quot;</span>: <span class="string">&quot;subnet-09dda752&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;InstanceType&quot;</span>: <span class="string">&quot;t2.micro&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;NetworkInterfaces&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;in-use&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;0e:b4:86:cf:b2:78&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;SourceDestCheck&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                            <span class="string">&quot;VpcId&quot;</span>: <span class="string">&quot;vpc-adb325cb&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Description&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Association&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;PublicIp&quot;</span>: <span class="string">&quot;54.242.90.155&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;PublicDnsName&quot;</span>: <span class="string">&quot;ec2-54-242-90-155.compute-1.amazonaws.com&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;IpOwnerId&quot;</span>: <span class="string">&quot;amazon&quot;</span></span><br><span class="line">                            &#125;, </span><br><span class="line">                            <span class="string">&quot;NetworkInterfaceId&quot;</span>: <span class="string">&quot;eni-00f324c6&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;PrivateIpAddresses&quot;</span>: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-23-114.ec2.internal&quot;</span>, </span><br><span class="line">                                    <span class="string">&quot;Association&quot;</span>: &#123;</span><br><span class="line">                                        <span class="string">&quot;PublicIp&quot;</span>: <span class="string">&quot;54.242.90.155&quot;</span>, </span><br><span class="line">                                        <span class="string">&quot;PublicDnsName&quot;</span>: <span class="string">&quot;ec2-54-242-90-155.compute-1.amazonaws.com&quot;</span>, </span><br><span class="line">                                        <span class="string">&quot;IpOwnerId&quot;</span>: <span class="string">&quot;amazon&quot;</span></span><br><span class="line">                                    &#125;, </span><br><span class="line">                                    <span class="string">&quot;Primary&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                                    <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.23.114&quot;</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            ], </span><br><span class="line">                            <span class="string">&quot;PrivateDnsName&quot;</span>: <span class="string">&quot;ip-172-31-23-114.ec2.internal&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Attachment&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;attached&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;DeviceIndex&quot;</span>: 0, </span><br><span class="line">                                <span class="string">&quot;DeleteOnTermination&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                                <span class="string">&quot;AttachmentId&quot;</span>: <span class="string">&quot;eni-attach-cb5aed9b&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;AttachTime&quot;</span>: <span class="string">&quot;2017-03-19T04:29:59.000Z&quot;</span></span><br><span class="line">                            &#125;, </span><br><span class="line">                            <span class="string">&quot;Groups&quot;</span>: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;mysg&quot;</span>, </span><br><span class="line">                                    <span class="string">&quot;GroupId&quot;</span>: <span class="string">&quot;sg-a364e4df&quot;</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            ], </span><br><span class="line">                            <span class="string">&quot;Ipv6Addresses&quot;</span>: [], </span><br><span class="line">                            <span class="string">&quot;SubnetId&quot;</span>: <span class="string">&quot;subnet-09dda752&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;OwnerId&quot;</span>: <span class="string">&quot;624990436890&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;PrivateIpAddress&quot;</span>: <span class="string">&quot;172.31.23.114&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;SourceDestCheck&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                    <span class="string">&quot;Placement&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;Tenancy&quot;</span>: <span class="string">&quot;default&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;GroupName&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;AvailabilityZone&quot;</span>: <span class="string">&quot;us-east-1b&quot;</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="string">&quot;Hypervisor&quot;</span>: <span class="string">&quot;xen&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;BlockDeviceMappings&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;DeviceName&quot;</span>: <span class="string">&quot;/dev/sda1&quot;</span>, </span><br><span class="line">                            <span class="string">&quot;Ebs&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;attached&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;DeleteOnTermination&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                                <span class="string">&quot;VolumeId&quot;</span>: <span class="string">&quot;vol-033fa93cda37a3621&quot;</span>, </span><br><span class="line">                                <span class="string">&quot;AttachTime&quot;</span>: <span class="string">&quot;2017-03-19T04:30:00.000Z&quot;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ], </span><br><span class="line">                    <span class="string">&quot;Architecture&quot;</span>: <span class="string">&quot;x86_64&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;RootDeviceType&quot;</span>: <span class="string">&quot;ebs&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;RootDeviceName&quot;</span>: <span class="string">&quot;/dev/sda1&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;VirtualizationType&quot;</span>: <span class="string">&quot;hvm&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;AmiLaunchIndex&quot;</span>: 0</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>According to the above, our named server “PublicIpAddress” is “54.91.19.43”.<br>Clinet Public Dns is “ec2-54-242-90-155.compute-1.amazonaws.com”.</p>
<p>SSH to the client and change to ‘root’ user.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  Documents git:(master) ✗ ssh -i p.pem ec2-user@ec2-54-242-90-155.compute-1.amazonaws.com</span><br><span class="line">The authenticity of host <span class="string">&#x27;ec2-54-242-90-155.compute-1.amazonaws.com (54.242.90.155)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:RjBCp8++iMcmgBP9LgmWNnBwz+/+gaFJmyooX7fFmnc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>ec2-54-242-90-155.compute-1.amazonaws.com,54.242.90.155<span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">[ec2-user@ip-172-31-23-114 ~]$ sudo su</span></span><br><span class="line"><span class="string">[root@ip-172-31-23-114 ec2-user]# </span></span><br></pre></td></tr></table></figure>
<p>Edit &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-lo (add ‘DNS&#x3D;54.91.19.43’ in the end):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=lo</span><br><span class="line">IPADDR=127.0.0.1</span><br><span class="line">NETMASK=255.0.0.0</span><br><span class="line">NETWORK=127.0.0.0</span><br><span class="line"># If you&#x27;re having problems with gated making 127.0.0.0/8 a martian,</span><br><span class="line"># you can change this to something else (255.255.255.255, for example)</span><br><span class="line">BROADCAST=127.255.255.255</span><br><span class="line">ONBOOT=yes</span><br><span class="line">NAME=loopback</span><br><span class="line">DNS=54.91.19.43</span><br></pre></td></tr></table></figure>
<p>Edit &#x2F;etc&#x2F;resolv.conf:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-23-114 ~]$ vi /etc/resolv.conf</span><br><span class="line"></span><br><span class="line">nameserver 54.91.19.43</span><br></pre></td></tr></table></figure>

<p>First, I find I can’t visit my name server. After a few mins, I realized that I didn’t set inbound of my ec2 security group to allow UDP request. Then I added rule of inbound to allow ALL UDP from my client ip in this security group.</p>
<h2 id="tcpdump-exercises"><a href="#tcpdump-exercises" class="headerlink" title="tcpdump exercises"></a>tcpdump exercises</h2><h3 id="First-scenario"><a href="#First-scenario" class="headerlink" title="First scenario"></a>First scenario</h3><h4 id="Install-telnet-and-tcpdump"><a href="#Install-telnet-and-tcpdump" class="headerlink" title="Install telnet and tcpdump"></a>Install telnet and tcpdump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># yum install tcpdump</span></span><br><span class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</span><br><span class="line">rhui-REGION-client-config-server-7                       | 2.9 kB     00:00     </span><br><span class="line">rhui-REGION-rhel-server-releases                         | 3.5 kB     00:00     </span><br><span class="line">rhui-REGION-rhel-server-rh-common                        | 3.8 kB     00:00     </span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package tcpdump.x86_64 14:4.5.1-3.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> Package   Arch     Version            Repository                          Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> tcpdump   x86_64   14:4.5.1-3.el7     rhui-REGION-rhel-server-releases   388 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 388 k</span><br><span class="line">Installed size: 931 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">tcpdump-4.5.1-3.el7.x86_64.rpm                             | 388 kB   00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : 14:tcpdump-4.5.1-3.el7.x86_64                                1/1 </span><br><span class="line">  Verifying  : 14:tcpdump-4.5.1-3.el7.x86_64                                1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  tcpdump.x86_64 14:4.5.1-3.el7                                                 </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># yum install telnet</span></span><br><span class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package telnet.x86_64 1:0.17-60.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> Package   Arch      Version          Repository                           Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> telnet    x86_64    1:0.17-60.el7    rhui-REGION-rhel-server-releases     63 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 63 k</span><br><span class="line">Installed size: 113 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">telnet-0.17-60.el7.x86_64.rpm                              |  63 kB   00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : 1:telnet-0.17-60.el7.x86_64                                  1/1 </span><br><span class="line">  Verifying  : 1:telnet-0.17-60.el7.x86_64                                  1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  telnet.x86_64 1:0.17-60.el7                                                   </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

<h3 id="Set-tcpdump-to-record-package-information"><a href="#Set-tcpdump-to-record-package-information" class="headerlink" title="Set tcpdump to record package information"></a>Set tcpdump to record package information</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># tcpdump -w tcpdump.out port not 22 &amp;</span></span><br><span class="line">[1] 19985</span><br><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</span></span><br><span class="line">arp -d -a</span><br><span class="line">gateway (172.31.16.1) at 0e:8a:cb:2d:0b:70 [ether] on eth0</span><br><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># telnet www.yahoo.com 80</span></span><br><span class="line">Trying 98.139.180.149...</span><br><span class="line">Connected to www.yahoo.com.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: www.yahoo.com</span><br><span class="line"></span><br><span class="line">HTTP/1.1 301 Redirect</span><br><span class="line">Date: Mon, 20 Mar 2017 01:42:51 GMT</span><br><span class="line">Via: https/1.1 ir4.fp.bf1.yahoo.com (ApacheTrafficServer)</span><br><span class="line">Server: ATS</span><br><span class="line">Location: https://www.yahoo.com/</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Language: en</span><br><span class="line">Cache-Control: no-store, no-cache</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 304</span><br><span class="line"></span><br><span class="line">&lt;HTML&gt;</span><br><span class="line">&lt;HEAD&gt;</span><br><span class="line">&lt;TITLE&gt;Document Has Moved&lt;/TITLE&gt;</span><br><span class="line">&lt;/HEAD&gt;</span><br><span class="line"></span><br><span class="line">&lt;BODY BGCOLOR=<span class="string">&quot;white&quot;</span> FGCOLOR=<span class="string">&quot;black&quot;</span>&gt;</span><br><span class="line">&lt;H1&gt;Document Has Moved&lt;/H1&gt;</span><br><span class="line">&lt;HR&gt;</span><br><span class="line"></span><br><span class="line">&lt;FONT FACE=<span class="string">&quot;Helvetica,Arial&quot;</span>&gt;&lt;B&gt;</span><br><span class="line">Description: The document you requested has moved to a new location.  The new location is <span class="string">&quot;https://www.yahoo.com/&quot;</span>.</span><br><span class="line">&lt;/B&gt;&lt;/FONT&gt;</span><br><span class="line">&lt;HR&gt;</span><br><span class="line">&lt;/BODY&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en-us&quot;</span>&gt;</span><br><span class="line">  &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Yahoo&lt;/title&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width,initial-scale=1,minimal-ui&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge,chrome=1&quot;</span>&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">      html &#123;</span><br><span class="line">          height: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">      body &#123;</span><br><span class="line">          background: <span class="comment">#fafafc url(https://s.yimg.com/nn/img/sad-panda-201402200631.png) 50% 50%;</span></span><br><span class="line">          background-size: cover;</span><br><span class="line">          height: 100%;</span><br><span class="line">          text-align: center;</span><br><span class="line">          font: 300 18px <span class="string">&quot;helvetica neue&quot;</span>, helvetica, verdana, tahoma, arial, sans-serif;</span><br><span class="line">          margin: 0;</span><br><span class="line">      &#125;</span><br><span class="line">      table &#123;</span><br><span class="line">          height: 100%;</span><br><span class="line">          width: 100%;</span><br><span class="line">          table-layout: fixed;</span><br><span class="line">          border-collapse: collapse;</span><br><span class="line">          border-spacing: 0;</span><br><span class="line">          border: none;</span><br><span class="line">      &#125;</span><br><span class="line">      h1 &#123;</span><br><span class="line">          font-size: 42px;</span><br><span class="line">          font-weight: 400;</span><br><span class="line">          color: <span class="comment">#400090;</span></span><br><span class="line">      &#125;</span><br><span class="line">      p &#123;</span><br><span class="line">          color: <span class="comment">#1A1A1A;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">#message-1 &#123;</span></span><br><span class="line">          font-weight: bold;</span><br><span class="line">          margin: 0;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">#message-2 &#123;</span></span><br><span class="line">          display: inline-block;</span><br><span class="line">          *display: inline;</span><br><span class="line">          zoom: 1;</span><br><span class="line">          max-width: 17em;</span><br><span class="line">          _width: 17em;</span><br><span class="line">      &#125;</span><br><span class="line">      &lt;/style&gt;</span><br><span class="line">      &lt;script&gt;</span><br><span class="line">      &lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;!-- status code : 400 --&gt;</span><br><span class="line">  &lt;!-- Bad Request: - --&gt;</span><br><span class="line">  &lt;!-- host machine: ir4.fp.bf1.yahoo.com --&gt;</span><br><span class="line">  &lt;!-- timestamp: 1489974172.000 --&gt;</span><br><span class="line">  &lt;!-- url: /--&gt;</span><br><span class="line">  &lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">function</span> buildUrl(url, parameters)&#123;</span><br><span class="line">      var qs = [];</span><br><span class="line">      <span class="keyword">for</span>(var key <span class="keyword">in</span> parameters) &#123;</span><br><span class="line">        var value = parameters[key];</span><br><span class="line">        qs.push(encodeURIComponent(key) + <span class="string">&quot;=&quot;</span> + encodeURIComponent(value));</span><br><span class="line">      &#125;</span><br><span class="line">      url = url + <span class="string">&quot;?&quot;</span> + qs.join(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">      <span class="built_in">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> addEvent( obj, <span class="built_in">type</span>, fn ) &#123;</span><br><span class="line">      <span class="keyword">if</span> ( obj.attachEvent ) &#123;</span><br><span class="line">        obj[<span class="string">&#x27;e&#x27;</span>+<span class="built_in">type</span>+fn] = fn;</span><br><span class="line">        obj[<span class="built_in">type</span>+fn] = <span class="function"><span class="title">function</span></span>()&#123;obj[<span class="string">&#x27;e&#x27;</span>+<span class="built_in">type</span>+fn]( window.event );&#125;</span><br><span class="line">        obj.attachEvent( <span class="string">&#x27;on&#x27;</span>+<span class="built_in">type</span>, obj[<span class="built_in">type</span>+fn] );</span><br><span class="line">      &#125; <span class="keyword">else</span></span><br><span class="line">        obj.addEventListener( <span class="built_in">type</span>, fn, <span class="literal">false</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> generateBRBMarkup(site) &#123;</span><br><span class="line">      params.source = <span class="string">&#x27;brb&#x27;</span>;</span><br><span class="line">      generateBeaconMarkup(params);</span><br><span class="line">      var englishHeader = <span class="string">&#x27;Will be right back...&#x27;</span>;</span><br><span class="line">      var englishMessage1 = <span class="string">&#x27;Thank you for your patience.&#x27;</span>;</span><br><span class="line">      var englishMessage2 = <span class="string">&#x27;Our engineers are working quickly to resolve the issue.&#x27;</span>;</span><br><span class="line">      var defaultLogoStyle = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      var siteDataMap = &#123;</span><br><span class="line">        <span class="string">&#x27;att.yahoo.com&#x27;</span>: &#123;</span><br><span class="line">          logo: <span class="string">&#x27;https://s1.yimg.com/rz/d/att_en-US_f_p_bestfit_2x.png&#x27;</span>,</span><br><span class="line">          logoAlt: <span class="string">&#x27;AT&amp;T&#x27;</span>,</span><br><span class="line">          logoStyle: defaultLogoStyle,</span><br><span class="line">          header: englishHeader,</span><br><span class="line">          message1: englishMessage1,</span><br><span class="line">          message2: englishMessage2</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;espanol.att.yahoo.com&#x27;</span>: &#123;</span><br><span class="line">          logo: <span class="string">&#x27;https://s1.yimg.com/rz/d/att_es-US_f_p_bestfit_2x.png&#x27;</span>,</span><br><span class="line">          logoAlt: <span class="string">&#x27;AT&amp;T En Vivo&#x27;</span>,</span><br><span class="line">          logoStyle: <span class="string">&#x27;max-width:310px;&#x27;</span>,</span><br><span class="line">          header: <span class="string">&#x27;Volvemos enseguida…&#x27;</span>,</span><br><span class="line">          message1: <span class="string">&#x27;Gracias por tu paciencia.&#x27;</span>,</span><br><span class="line">          message2: <span class="string">&#x27;Nuestros ingenieros están trabajando rápidamente para resolver el problema.&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">          logo: <span class="string">&#x27;https://s.yimg.com/nn/img/yahoo-logo-201402200629.png&#x27;</span>,</span><br><span class="line">          logoAlt: <span class="string">&#x27;Yahoo Logo&#x27;</span>,</span><br><span class="line">          logoStyle: defaultLogoStyle,</span><br><span class="line">          header: englishHeader,</span><br><span class="line">          message1: englishMessage1,</span><br><span class="line">          message2: englishMessage2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      var siteDetails = siteDataMap[<span class="string">&#x27;default&#x27;</span>];</span><br><span class="line">      switch (site) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;espanol.att.yahoo.com&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;att.yahoo.com&#x27;</span>:</span><br><span class="line">          siteDetails = siteDataMap[site];</span><br><span class="line">          <span class="built_in">break</span>;</span><br><span class="line">        default:</span><br><span class="line">          siteDetails = siteDataMap[<span class="string">&#x27;default&#x27;</span>];</span><br><span class="line">          <span class="built_in">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      document.write(<span class="string">&#x27;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&#x27;</span>);</span><br><span class="line">      document.write(<span class="string">&#x27;&lt;div id=&quot;content&quot;&gt;&#x27;</span>);</span><br><span class="line">      document.write(<span class="string">&#x27;&lt;img src=&quot;&#x27;</span> + siteDetails[<span class="string">&#x27;logo&#x27;</span>] + <span class="string">&#x27;&quot; alt=&quot;&#x27;</span> + siteDetails[<span class="string">&#x27;logoAlt&#x27;</span>] + <span class="string">&#x27;&quot; style=&quot;&#x27;</span> + siteDetails[<span class="string">&#x27;logoStyle&#x27;</span>] + <span class="string">&#x27;&quot;&gt;&#x27;</span>);</span><br><span class="line">      document.write(<span class="string">&#x27;&lt;h1 style=&quot;margin-top:20px;&quot;&gt;&#x27;</span> + siteDetails[<span class="string">&#x27;header&#x27;</span>] + <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">      document.write(<span class="string">&#x27;&lt;p id=&quot;message-1&quot;&gt;&#x27;</span> + siteDetails[<span class="string">&#x27;message1&#x27;</span>] + <span class="string">&#x27;&lt;/p&gt;&#x27;</span>);</span><br><span class="line">      document.write(<span class="string">&#x27;&lt;p id=&quot;message-2&quot;&gt;&#x27;</span> + siteDetails[<span class="string">&#x27;message2&#x27;</span>] + <span class="string">&#x27;&lt;/p&gt;&#x27;</span>);</span><br><span class="line">      document.write(<span class="string">&#x27;&lt;/div&gt;&#x27;</span>);</span><br><span class="line">      document.write(<span class="string">&#x27;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> generateIframeMarkup(iframeUrl, params) &#123;</span><br><span class="line">      params.source = <span class="string">&#x27;brbiframe&#x27;</span>;</span><br><span class="line">      generateBeaconMarkup(params);</span><br><span class="line">      document.write(<span class="string">&#x27;&lt;iframe src=&quot;&#x27;</span> + iframeUrl + <span class="string">&#x27;&quot; style=&quot;width:100%;height:100%;border:none;&quot; &gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> generateBeaconMarkup(params) &#123;</span><br><span class="line">        document.write(<span class="string">&#x27;&lt;img src=&quot;&#x27;</span> + buildUrl(<span class="string">&#x27;//geo.yahoo.com/b&#x27;</span>, params) + <span class="string">&#x27;&quot; style=&quot;display:none;&quot; width=&quot;0px&quot; height=&quot;0px&quot;/&gt;&#x27;</span>);</span><br><span class="line">        var beacon = new Image();</span><br><span class="line">        beacon.src = buildUrl(<span class="string">&#x27;//bcn.fp.yahoo.com/p&#x27;</span>, params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var hostname = window.location.hostname;</span><br><span class="line">    var device = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">    var ynet = (<span class="string">&#x27;-&#x27;</span> === <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    var brbHost = <span class="string">&#x27;brb.yahoo.com&#x27;</span>;</span><br><span class="line">    var brbProto = <span class="string">&#x27;https://&#x27;</span>;</span><br><span class="line">    var brbIframePath = <span class="string">&#x27;/iframe.php&#x27;</span>;</span><br><span class="line">    var brbParams = &#123;</span><br><span class="line">      protocol: window.location.protocol,</span><br><span class="line">      host: hostname,</span><br><span class="line">      path: window.location.pathname,</span><br><span class="line">      device: device</span><br><span class="line">    &#125;;</span><br><span class="line">    var iframeUrl = buildUrl(brbProto + brbHost + brbIframePath, brbParams);</span><br><span class="line">    var iframeDisabled = !<span class="literal">true</span>;</span><br><span class="line">    var time = new Date().getTime();</span><br><span class="line">    var params = &#123;</span><br><span class="line">        s: <span class="string">&#x27;1197757129&#x27;</span>,</span><br><span class="line">        t: time,</span><br><span class="line">        err_url: document.URL,</span><br><span class="line">        err: <span class="string">&#x27;400&#x27;</span>,</span><br><span class="line">        <span class="built_in">test</span>: <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">        ats_host: <span class="string">&#x27;ir4.fp.bf1.yahoo.com&#x27;</span>,</span><br><span class="line">        rid: <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">        message: <span class="string">&#x27;Bad Request: -&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ynet) &#123;</span><br><span class="line">        document.write(<span class="string">&#x27;&lt;div style=&quot;height: 5px; background-color: red;&quot;&gt;&lt;/div&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hostname.match(<span class="string">&#x27;att.yahoo.com&#x27;</span>) || iframeDisabled) &#123;</span><br><span class="line">      generateBRBMarkup(hostname, params);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      generateIframeMarkup(iframeUrl, params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addEvent(window, <span class="string">&quot;message&quot;</span>, <span class="keyword">function</span>(event) &#123;</span><br><span class="line">      <span class="keyword">if</span> (event.origin !== (brbProto + brbHost)) &#123;</span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (event &amp;&amp; event.data &amp;&amp; event.data.url) &#123;</span><br><span class="line">        window.location.replace(event.data.url);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  &lt;noscript&gt;</span><br><span class="line">  &lt;table&gt;</span><br><span class="line">    &lt;tbody&gt;</span><br><span class="line">      &lt;<span class="built_in">tr</span>&gt;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">          &lt;div <span class="built_in">id</span>=<span class="string">&quot;englishContent&quot;</span>&gt;</span><br><span class="line">            &lt;h1 style=<span class="string">&quot;margin-top:20px;&quot;</span>&gt;Will be right back...&lt;/h1&gt;</span><br><span class="line">            &lt;p <span class="built_in">id</span>=<span class="string">&quot;message-1&quot;</span>&gt;Thank you <span class="keyword">for</span> your patience.&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="built_in">id</span>=<span class="string">&quot;message-2&quot;</span>&gt;Our engineers are working quickly to resolve the issue.&lt;/p&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">      &lt;/tr&gt;</span><br><span class="line">    &lt;/tbody&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">  &lt;/noscript&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># kill %1</span></span><br><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># 26 packets captured</span></span><br><span class="line">26 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line">[1]+  Done                    tcpdump -w tcpdump.out port not 22</span><br></pre></td></tr></table></figure>

<h3 id="Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Yahoo’s-authoritative-DNS-servers"><a href="#Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Yahoo’s-authoritative-DNS-servers" class="headerlink" title="Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Yahoo’s authoritative DNS servers."></a>Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Yahoo’s authoritative DNS servers.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># tcpdump -t -n -r tcpdump.out udp port 53</span></span><br><span class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</span><br><span class="line">IP 172.31.30.115.18721 &gt; 68.142.255.16.domain: 45641% [1au] A? www.yahoo.com. (42)</span><br><span class="line">IP 172.31.30.115.53735 &gt; 68.142.255.16.domain: 9034% [1au] AAAA? www.yahoo.com. (42)</span><br><span class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.18721: 45641*- 1/4/3 CNAME fd-fp3.wg1.b.yahoo.com. (187)</span><br><span class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.53735: 9034*- 1/4/3 CNAME fd-fp3.wg1.b.yahoo.com. (187)</span><br><span class="line">IP 172.31.30.115.17127 &gt; 68.180.130.15.domain: 64011% [1au] A? fd-fp3.wg1.b.yahoo.com. (51)</span><br><span class="line">IP 172.31.30.115.48161 &gt; 68.180.130.15.domain: 52861% [1au] AAAA? fd-fp3.wg1.b.yahoo.com. (51)</span><br><span class="line">IP 68.180.130.15.domain &gt; 172.31.30.115.17127: 64011*- 2/0/1 A 98.139.180.149, A 98.139.183.24 (83)</span><br><span class="line">IP 68.180.130.15.domain &gt; 172.31.30.115.48161: 52861*- 1/0/1 AAAA 2001:4998:58:c02::a9 (79)</span><br></pre></td></tr></table></figure>

<h3 id="Identify-the-3-way-handshake-that-initiates-the-connection-from-your-DNS-server-to-port-80-on-Yahoo’s-webserver-the-packets-that-are-being-sent-back-and-forth-and-finally-the-closing-of-the-connection"><a href="#Identify-the-3-way-handshake-that-initiates-the-connection-from-your-DNS-server-to-port-80-on-Yahoo’s-webserver-the-packets-that-are-being-sent-back-and-forth-and-finally-the-closing-of-the-connection" class="headerlink" title="Identify the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver, the packets that are being sent back and forth and finally the closing of the connection."></a>Identify the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver, the packets that are being sent back and forth and finally the closing of the connection.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 ec2-user]<span class="comment"># tcpdump -n -r tcpdump.out tcp port 80</span></span><br><span class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</span><br><span class="line">21:42:35.282439 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [S], <span class="built_in">seq</span> 854216136, win 26883, options [mss 8961,sackOK,TS val 97995307 ecr 0,nop,wscale 7], length 0</span><br><span class="line">21:42:35.299558 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [S.], <span class="built_in">seq</span> 225539872, ack 854216137, win 8192, options [mss 1460,nop,nop,sackOK,nop,wscale 8], length 0</span><br><span class="line">21:42:35.299596 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 1, win 211, length 0</span><br><span class="line">21:42:41.537040 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], <span class="built_in">seq</span> 1:17, ack 1, win 211, length 16</span><br><span class="line">21:42:41.555263 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 17, win 58, length 0</span><br><span class="line">21:42:50.064128 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], <span class="built_in">seq</span> 17:38, ack 1, win 211, length 21</span><br><span class="line">21:42:50.082376 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 38, win 58, length 0</span><br><span class="line">21:42:51.033280 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], <span class="built_in">seq</span> 38:40, ack 1, win 211, length 2</span><br><span class="line">21:42:51.051567 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 40, win 58, length 0</span><br><span class="line">21:42:51.053313 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [P.], <span class="built_in">seq</span> 1:600, ack 40, win 58, length 599</span><br><span class="line">21:42:51.053331 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 600, win 220, length 0</span><br><span class="line">21:42:52.502208 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], <span class="built_in">seq</span> 40:42, ack 600, win 220, length 2</span><br><span class="line">21:42:52.521318 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], <span class="built_in">seq</span> 600:3520, ack 42, win 58, length 2920</span><br><span class="line">21:42:52.521346 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 3520, win 266, length 0</span><br><span class="line">21:42:52.539662 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [FP.], <span class="built_in">seq</span> 3520:7066, ack 42, win 58, length 3546</span><br><span class="line">21:42:52.539691 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 7067, win 321, length 0</span><br><span class="line">21:42:52.539912 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [F.], <span class="built_in">seq</span> 42, ack 7067, win 321, length 0</span><br><span class="line">21:42:52.558114 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 43, win 58, length 0</span><br></pre></td></tr></table></figure>


<p>This is the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">21:42:35.282439 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [S], <span class="built_in">seq</span> 854216136, win 26883, options [mss 8961,sackOK,TS val 97995307 ecr 0,nop,wscale 7], length 0</span><br><span class="line">21:42:35.299558 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [S.], <span class="built_in">seq</span> 225539872, ack 854216137, win 8192, options [mss 1460,nop,nop,sackOK,nop,wscale 8], length 0</span><br><span class="line">21:42:35.299596 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 1, win 211, length 0</span><br></pre></td></tr></table></figure>

<p>The packets that are being sent back :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">21:42:41.537040 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], <span class="built_in">seq</span> 1:17, ack 1, win 211, length 16</span><br><span class="line">21:42:41.555263 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 17, win 58, length 0</span><br><span class="line">21:42:50.064128 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], <span class="built_in">seq</span> 17:38, ack 1, win 211, length 21</span><br><span class="line">21:42:50.082376 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 38, win 58, length 0</span><br><span class="line">21:42:51.033280 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], <span class="built_in">seq</span> 38:40, ack 1, win 211, length 2</span><br><span class="line">21:42:51.051567 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 40, win 58, length 0</span><br></pre></td></tr></table></figure>

<p>and forth:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">21:42:51.053313 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [P.], <span class="built_in">seq</span> 1:600, ack 40, win 58, length 599</span><br><span class="line">21:42:51.053331 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 600, win 220, length 0</span><br><span class="line">21:42:52.502208 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], <span class="built_in">seq</span> 40:42, ack 600, win 220, length 2</span><br><span class="line">21:42:52.521318 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], <span class="built_in">seq</span> 600:3520, ack 42, win 58, length 2920</span><br><span class="line">21:42:52.521346 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 3520, win 266, length 0</span><br></pre></td></tr></table></figure>

<p>and finally the closing of the connection:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">21:42:52.539662 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [FP.], <span class="built_in">seq</span> 3520:7066, ack 42, win 58, length 3546</span><br><span class="line">21:42:52.539691 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 7067, win 321, length 0</span><br><span class="line">21:42:52.539912 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [F.], <span class="built_in">seq</span> 42, ack 7067, win 321, length 0</span><br><span class="line">21:42:52.558114 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 43, win 58, length 0</span><br></pre></td></tr></table></figure>

<h2 id="Second-scenarios"><a href="#Second-scenarios" class="headerlink" title="Second scenarios"></a>Second scenarios</h2><h3 id="Install-tcpdump-and-telnet-on-client-the-same-step-as-first-scenarios"><a href="#Install-tcpdump-and-telnet-on-client-the-same-step-as-first-scenarios" class="headerlink" title="Install tcpdump and telnet on client (the same step as first scenarios.)"></a>Install tcpdump and telnet on client (the same step as first scenarios.)</h3><h3 id="Set-tcpdump-to-listen"><a href="#Set-tcpdump-to-listen" class="headerlink" title="Set tcpdump to listen"></a>Set tcpdump to listen</h3><p>On server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 ~]<span class="comment"># tcpdump -w tcpdump.out port not 22 &amp;</span></span><br><span class="line">[1] 19713</span><br><span class="line">[root@ip-172-31-30-115 ~]<span class="comment"># tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</span></span><br><span class="line">arp -d -a</span><br><span class="line">gateway (172.31.16.1) at 0e:8a:cb:2d:0b:70 [ether] on eth0</span><br></pre></td></tr></table></figure>

<p>On client:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-23-114 ~]<span class="comment"># tcpdump -w tcpdump.out port not 22 &amp;</span></span><br><span class="line">[1] 18272</span><br><span class="line">[root@ip-172-31-23-114 ~]<span class="comment"># tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</span></span><br><span class="line">arp -d -a</span><br><span class="line">gateway (172.31.16.1) at 0e:8a:cb:2d:0b:70 [ether] on eth0</span><br></pre></td></tr></table></figure>
<h3 id="Run-telnet"><a href="#Run-telnet" class="headerlink" title="Run telnet"></a>Run telnet</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-23-114 ~]<span class="comment"># telnet www.tumblr.com 80</span></span><br><span class="line">Trying 69.147.82.57...</span><br><span class="line">Connected to www.tumblr.com.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line">GET / HTTP/1.0</span><br><span class="line"></span><br><span class="line">HTTP/1.0 400 Host Header Required</span><br><span class="line">Date: Sun, 19 Mar 2017 23:38:52 GMT</span><br><span class="line">Via: http/1.1 e4.ycpi.nya.yahoo.com (ApacheTrafficServer [c s f ])</span><br><span class="line">Server: ATS</span><br><span class="line">Cache-Control: no-store</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Language: en</span><br><span class="line">Content-Length: 2810</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en-us&quot;</span>&gt;&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Yahoo&lt;/title&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width,initial-scale=1,minimal-ui&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge,chrome=1&quot;</span>&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">html &#123;</span><br><span class="line">    height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">body &#123;</span><br><span class="line">    background: <span class="comment">#fafafc url(https://s.yimg.com/nn/img/sad-panda-201402200631.png) 50% 50%;</span></span><br><span class="line">    background-size: cover;</span><br><span class="line">    height: 100%;</span><br><span class="line">    text-align: center;</span><br><span class="line">    font: 300 18px <span class="string">&quot;helvetica neue&quot;</span>, helvetica, verdana, tahoma, arial, sans-serif;</span><br><span class="line">&#125;</span><br><span class="line">table &#123;</span><br><span class="line">    height: 100%;</span><br><span class="line">    width: 100%;</span><br><span class="line">    table-layout: fixed;</span><br><span class="line">    border-collapse: collapse;</span><br><span class="line">    border-spacing: 0;</span><br><span class="line">    border: none;</span><br><span class="line">&#125;</span><br><span class="line">h1 &#123;</span><br><span class="line">    font-size: 42px;</span><br><span class="line">    font-weight: 400;</span><br><span class="line">    color: <span class="comment">#400090;</span></span><br><span class="line">&#125;</span><br><span class="line">p &#123;</span><br><span class="line">    color: <span class="comment">#1A1A1A;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#message-1 &#123;</span></span><br><span class="line">    font-weight: bold;</span><br><span class="line">    margin: 0;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#message-2 &#123;</span></span><br><span class="line">    display: inline-block;</span><br><span class="line">    *display: inline;</span><br><span class="line">    zoom: 1;</span><br><span class="line">    max-width: 17em;</span><br><span class="line">    _width: 17em;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#spanishContent &#123;</span></span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  document.write(<span class="string">&#x27;&lt;img src=&quot;//geo.yahoo.com/b?s=1197757129&amp;t=&#x27;</span>+new Date().getTime()+<span class="string">&#x27;&amp;err_url=&#x27;</span>+encodeURIComponent(document.URL)+<span class="string">&#x27;&amp;err=400&amp;test=&#x27;</span>+encodeURIComponent(<span class="string">&#x27;-&#x27;</span>)+<span class="string">&#x27;&quot; width=&quot;0px&quot; height=&quot;0px&quot;/&gt;&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!-- status code : 400 --&gt;</span><br><span class="line">&lt;!-- Host Header Required --&gt;</span><br><span class="line">&lt;!-- host machine: e4.ycpi.nya.yahoo.com --&gt;</span><br><span class="line">&lt;!-- timestamp: 1489966732.000 --&gt;</span><br><span class="line">&lt;!-- url: http:///--&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tbody&gt;&lt;<span class="built_in">tr</span>&gt;</span><br><span class="line">    &lt;td&gt;</span><br><span class="line">    &lt;div <span class="built_in">id</span>=<span class="string">&quot;englishContent&quot;</span>&gt;</span><br><span class="line">        &lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">        <span class="keyword">if</span> (window.location.hostname==<span class="string">&#x27;att.yahoo.com&#x27;</span>)&#123;</span><br><span class="line">            document.write(<span class="string">&#x27;&lt;img src=&quot;https://s1.yimg.com/rz/d/att_en-US_f_p_bestfit_2x.png&quot; alt=&quot;AT&amp;T&quot;&gt;&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            document.write(<span class="string">&#x27;&lt;img src=&quot;https://s.yimg.com/nn/img/yahoo-logo-201402200629.png&quot; alt=&quot;Yahoo Logo&quot;&gt;&#x27;</span>);</span><br><span class="line">        &#125;    </span><br><span class="line">        &lt;/script&gt; </span><br><span class="line">        &lt;h1 style=<span class="string">&quot;margin-top:20px;&quot;</span>&gt;Will be right back...&lt;/h1&gt;</span><br><span class="line">        &lt;p <span class="built_in">id</span>=<span class="string">&quot;message-1&quot;</span>&gt;Thank you <span class="keyword">for</span> your patience.&lt;/p&gt;</span><br><span class="line">        &lt;p <span class="built_in">id</span>=<span class="string">&quot;message-2&quot;</span>&gt;Our engineers are working quickly to resolve the issue.&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="built_in">id</span>=<span class="string">&quot;spanishContent&quot;</span>&gt; </span><br><span class="line">        &lt;img src=<span class="string">&quot;https://s1.yimg.com/rz/d/att_es-US_f_p_bestfit_2x.png&quot;</span> alt=<span class="string">&quot;AT&amp;T En Vivo&quot;</span> style=<span class="string">&quot;max-width:310px&quot;</span>&gt;</span><br><span class="line">        &lt;h1 style=<span class="string">&quot;margin-top:20px;&quot;</span>&gt;Volvemos enseguida…&lt;/h1&gt;</span><br><span class="line">        &lt;p <span class="built_in">id</span>=<span class="string">&quot;message-1&quot;</span>&gt;Gracias por tu paciencia.&lt;/p&gt;</span><br><span class="line">        &lt;p <span class="built_in">id</span>=<span class="string">&quot;message-2&quot;</span>&gt;Nuestros ingenieros están trabajando rápidamente para resolver el problema.&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">if</span> (window.location.hostname==<span class="string">&#x27;espanol.att.yahoo.com&#x27;</span>)&#123;</span><br><span class="line">        document.getElementById(<span class="string">&#x27;englishContent&#x27;</span>).style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        document.getElementById(<span class="string">&#x27;spanishContent&#x27;</span>).style.display = <span class="string">&#x27;block&#x27;</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/tbody&gt;&lt;/table&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line">[root@ip-172-31-23-114 ~]<span class="comment"># kill %1</span></span><br><span class="line">[root@ip-172-31-23-114 ~]<span class="comment"># 33 packets captured</span></span><br><span class="line">33 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line">[1]+  Done                    tcpdump -w tcpdump.out port not 22</span><br></pre></td></tr></table></figure>
<h3 id="Track-down-the-packets-in-tcpdump-referring-to-the-DNS-query-from-your-client-host-to-DNS-server"><a href="#Track-down-the-packets-in-tcpdump-referring-to-the-DNS-query-from-your-client-host-to-DNS-server" class="headerlink" title="Track down the packets in tcpdump referring to the DNS query from your client host to DNS server."></a>Track down the packets in tcpdump referring to the DNS query from your client host to DNS server.</h3><p>On client:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-23-114 ~]<span class="comment"># tcpdump -t -n -r tcpdump.out udp port 53</span></span><br><span class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</span><br><span class="line">IP 172.31.23.114.50439 &gt; 54.91.19.43.domain: 57805+ PTR? 1.16.31.172.in-addr.arpa. (42)</span><br><span class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.50439: 57805 NXDomain* 0/1/0 (77)</span><br><span class="line">IP 172.31.23.114.60063 &gt; 54.91.19.43.domain: 42152+ PTR? 218.24.13.126.in-addr.arpa. (44)</span><br><span class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.60063: 42152 1/2/0 PTR softbank126013024218.bbtec.net. (128)</span><br><span class="line">IP 172.31.23.114.48371 &gt; 54.91.19.43.domain: 58570+ A? softbank126013024218.bbtec.net. (48)</span><br><span class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.48371: 58570 1/2/2 A 126.13.24.218 (136)</span><br><span class="line">IP 172.31.23.114.40529 &gt; 54.91.19.43.domain: 30948+ A? softbank126013024218.bbtec.net. (48)</span><br><span class="line">IP 172.31.23.114.40529 &gt; 54.91.19.43.domain: 36622+ AAAA? softbank126013024218.bbtec.net. (48)</span><br><span class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.40529: 30948 1/2/2 A 126.13.24.218 (136)</span><br><span class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.40529: 36622 0/1/0 (94)</span><br><span class="line">IP 172.31.23.114.32918 &gt; 54.91.19.43.domain: 35896+ A? www.tumblr.com. (32)</span><br><span class="line">IP 172.31.23.114.32918 &gt; 54.91.19.43.domain: 2913+ AAAA? www.tumblr.com. (32)</span><br><span class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.32918: 35896 5/4/2 CNAME e2p-v4.gycs.b.yahoodns.net., A 69.147.82.57, A 69.147.92.13, A 69.147.82.56, A 69.147.92.14 (257)</span><br><span class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.32918: 2913 1/1/0 CNAME e2p-v4.gycs.b.yahoodns.net. (139)</span><br></pre></td></tr></table></figure>

<h3 id="Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Tumblr’s-authoritative-DNS-servers"><a href="#Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Tumblr’s-authoritative-DNS-servers" class="headerlink" title="Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Tumblr’s authoritative DNS servers."></a>Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Tumblr’s authoritative DNS servers.</h3><p>On server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 ~]<span class="comment"># kill %1</span></span><br><span class="line">[root@ip-172-31-30-115 ~]<span class="comment"># 124 packets captured</span></span><br><span class="line">124 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line">[1]+  Done                    tcpdump -w tcpdump.out port not 22</span><br><span class="line">[root@ip-172-31-30-115 ~]<span class="comment"># tcpdump -t -n -r tcpdump.out udp port 53</span></span><br><span class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</span><br><span class="line">IP 54.242.90.155.50439 &gt; 172.31.30.115.domain: 57805+ PTR? 1.16.31.172.in-addr.arpa. (42)</span><br><span class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.50439: 57805 NXDomain* 0/1/0 (77)</span><br><span class="line">IP 54.242.90.155.60063 &gt; 172.31.30.115.domain: 42152+ PTR? 218.24.13.126.in-addr.arpa. (44)</span><br><span class="line">IP 172.31.30.115.12672 &gt; 193.0.9.1.domain: 25355% [1au] PTR? 218.24.13.126.in-addr.arpa. (55)</span><br><span class="line">IP 193.0.9.1.domain &gt; 172.31.30.115.12672: 25355- 0/7/1 (377)</span><br><span class="line">IP 172.31.30.115.9590 &gt; 202.12.28.131.domain: 893% [1au] PTR? 218.24.13.126.in-addr.arpa. (55)</span><br><span class="line">IP 172.31.30.115.16018 &gt; 192.12.94.30.domain: 4896% [1au] A? ns001.bbtec.net. (44)</span><br><span class="line">IP 172.31.30.115.28464 &gt; 192.12.94.30.domain: 35378% [1au] AAAA? ns001.bbtec.net. (44)</span><br><span class="line">IP 172.31.30.115.39371 &gt; 192.12.94.30.domain: 28698% [1au] A? ns002.bbtec.net. (44)</span><br><span class="line">IP 172.31.30.115.64953 &gt; 192.12.94.30.domain: 61674% [1au] AAAA? ns002.bbtec.net. (44)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.16018: 4896- 0/6/3 (601)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.28464: 35378- 0/6/3 (601)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.39371: 28698- 0/6/3 (601)</span><br><span class="line">IP 172.31.30.115.64318 &gt; 218.176.253.105.domain: 44419% [1au] A? ns001.bbtec.net. (44)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.64953: 61674- 0/6/3 (601)</span><br><span class="line">IP 172.31.30.115.64670 &gt; 218.176.253.105.domain: 43269% [1au] AAAA? ns001.bbtec.net. (44)</span><br><span class="line">IP 172.31.30.115.15986 &gt; 218.176.253.105.domain: 49175% [1au] A? ns002.bbtec.net. (44)</span><br><span class="line">IP 172.31.30.115.12481 &gt; 218.176.253.105.domain: 30143% [1au] AAAA? ns002.bbtec.net. (44)</span><br><span class="line">IP 202.12.28.131.domain &gt; 172.31.30.115.9590: 893- 0/2/1 (104)</span><br><span class="line">IP 218.176.253.105.domain &gt; 172.31.30.115.64670: 43269*- 0/1/1 (90)</span><br><span class="line">IP 218.176.253.105.domain &gt; 172.31.30.115.12481: 30143*- 0/1/1 (90)</span><br><span class="line">IP 218.176.253.105.domain &gt; 172.31.30.115.15986: 49175*- 1/2/3 A 218.176.253.104 (132)</span><br><span class="line">IP 172.31.30.115.12796 &gt; 218.176.253.104.domain: 1893% [1au] PTR? 218.24.13.126.in-addr.arpa. (55)</span><br><span class="line">IP 218.176.253.105.domain &gt; 172.31.30.115.64318: 44419*- 1/2/3 A 218.176.253.72 (132)</span><br><span class="line">IP 218.176.253.104.domain &gt; 172.31.30.115.12796: 1893*- 1/2/1 PTR softbank126013024218.bbtec.net. (139)</span><br><span class="line">IP 172.31.30.115.15402 &gt; 200.10.60.53.domain: 35634% [1au] DS? 126.in-addr.arpa. (45)</span><br><span class="line">IP 200.10.60.53.domain &gt; 172.31.30.115.15402: 35634*- 0/4/1 (501)</span><br><span class="line">IP 172.31.30.115.29985 &gt; 199.212.0.73.domain: 54806% [1au] DNSKEY? in-addr.arpa. (41)</span><br><span class="line">IP 199.212.0.73.domain &gt; 172.31.30.115.29985: 54806*- 5/0/1 DNSKEY, DNSKEY, DNSKEY, RRSIG, RRSIG (1344)</span><br><span class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.60063: 42152 1/2/0 PTR softbank126013024218.bbtec.net. (128)</span><br><span class="line">IP 54.242.90.155.48371 &gt; 172.31.30.115.domain: 58570+ A? softbank126013024218.bbtec.net. (48)</span><br><span class="line">IP 172.31.30.115.23886 &gt; 218.176.253.73.domain: 64646% [1au] A? softbank126013024218.bbtec.net. (59)</span><br><span class="line">IP 218.176.253.73.domain &gt; 172.31.30.115.23886: 64646*- 1/2/3 A 126.13.24.218 (147)</span><br><span class="line">IP 172.31.30.115.28358 &gt; 192.54.112.30.domain: 41306% [1au] DS? bbtec.net. (38)</span><br><span class="line">IP 192.54.112.30.domain &gt; 172.31.30.115.28358: 41306*- 0/6/1 (759)</span><br><span class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.48371: 58570 1/2/2 A 126.13.24.218 (136)</span><br><span class="line">IP 54.242.90.155.40529 &gt; 172.31.30.115.domain: 30948+ A? softbank126013024218.bbtec.net. (48)</span><br><span class="line">IP 54.242.90.155.40529 &gt; 172.31.30.115.domain: 36622+ AAAA? softbank126013024218.bbtec.net. (48)</span><br><span class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.40529: 30948 1/2/2 A 126.13.24.218 (136)</span><br><span class="line">IP 172.31.30.115.61458 &gt; 218.176.253.73.domain: 11958% [1au] AAAA? softbank126013024218.bbtec.net. (59)</span><br><span class="line">IP 218.176.253.73.domain &gt; 172.31.30.115.61458: 11958*- 0/1/1 (105)</span><br><span class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.40529: 36622 0/1/0 (94)</span><br><span class="line">IP 54.242.90.155.32918 &gt; 172.31.30.115.domain: 35896+ A? www.tumblr.com. (32)</span><br><span class="line">IP 54.242.90.155.32918 &gt; 172.31.30.115.domain: 2913+ AAAA? www.tumblr.com. (32)</span><br><span class="line">IP 172.31.30.115.50312 &gt; 192.5.6.30.domain: 15102% [1au] A? www.tumblr.com. (43)</span><br><span class="line">IP 172.31.30.115.55078 &gt; 192.5.6.30.domain: 24281% [1au] AAAA? www.tumblr.com. (43)</span><br><span class="line">IP 192.5.6.30.domain &gt; 172.31.30.115.50312: 15102- 0/14/15 (1000)</span><br><span class="line">IP 192.5.6.30.domain &gt; 172.31.30.115.55078: 24281- 0/14/15 (1000)</span><br><span class="line">IP 172.31.30.115.54183 &gt; 68.142.255.16.domain: 27760% [1au] A? www.tumblr.com. (43)</span><br><span class="line">IP 172.31.30.115.42766 &gt; 68.142.255.16.domain: 50340% [1au] AAAA? www.tumblr.com. (43)</span><br><span class="line">IP 172.31.30.115.20720 &gt; 192.12.94.30.domain: 56843% [1au] A? ns1.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.31015 &gt; 192.12.94.30.domain: 59860% [1au] AAAA? ns1.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.44619 &gt; 192.12.94.30.domain: 48475% [1au] A? ns2.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.29788 &gt; 192.12.94.30.domain: 9652% [1au] AAAA? ns2.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.57147 &gt; 192.12.94.30.domain: 62071% [1au] A? ns3.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.28255 &gt; 192.12.94.30.domain: 63541% [1au] AAAA? ns3.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.8489 &gt; 192.12.94.30.domain: 48551% [1au] A? ns4.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.55613 &gt; 192.12.94.30.domain: 31935% [1au] AAAA? ns4.p03.dynect.net. (47)</span><br><span class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.54183: 27760*- 1/4/3 CNAME e2p-v4.gycs.b.yahoodns.net. (204)</span><br><span class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.42766: 50340*- 1/4/3 CNAME e2p-v4.gycs.b.yahoodns.net. (204)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.20720: 56843- 0/11/13 (933)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.31015: 59860- 0/11/13 (933)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.44619: 48475- 0/11/13 (933)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.29788: 9652- 0/11/13 (933)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.57147: 62071- 0/11/13 (933)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.28255: 63541- 0/11/13 (933)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.8489: 48551- 0/11/13 (933)</span><br><span class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.55613: 31935- 0/11/13 (933)</span><br><span class="line">IP 172.31.30.115.59179 &gt; 204.13.250.136.domain: 32061% [1au] A? ns2.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.10967 &gt; 204.13.250.136.domain: 15199% [1au] AAAA? ns2.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.12591 &gt; 204.13.250.136.domain: 46251% [1au] A? ns3.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.23689 &gt; 204.13.250.136.domain: 49237% [1au] AAAA? ns3.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.20181 &gt; 204.13.250.136.domain: 23229% [1au] A? ns4.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.56792 &gt; 204.13.250.136.domain: 59367% [1au] AAAA? ns4.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.29332 &gt; 192.33.14.30.domain: 41065% [1au] DS? tumblr.com. (39)</span><br><span class="line">IP 172.31.30.115.60180 &gt; 204.13.250.136.domain: 12063% [1au] A? ns1.p03.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.59836 &gt; 204.13.250.136.domain: 47624% [1au] AAAA? ns1.p03.dynect.net. (47)</span><br><span class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.12591: 46251*- 1/7/1 A 208.78.71.3 (212)</span><br><span class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.10967: 15199*- 0/1/1 (131)</span><br><span class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.59179: 32061*- 1/7/1 A 204.13.250.3 (212)</span><br><span class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.59836: 47624*- 1/7/1 AAAA 2001:500:90:1::3 (224)</span><br><span class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.56792: 59367*- 0/1/1 (131)</span><br><span class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.20181: 23229*- 1/7/1 A 204.13.251.3 (212)</span><br><span class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.23689: 49237*- 1/7/1 AAAA 2001:500:94:1::3 (224)</span><br><span class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.60180: 12063*- 1/7/1 A 208.78.70.3 (212)</span><br><span class="line">IP 192.33.14.30.domain &gt; 172.31.30.115.29332: 41065*- 0/6/1 (760)</span><br><span class="line">IP 172.31.30.115.45512 &gt; 192.35.51.30.domain: 2908% [1au] AAAA? e2p-v4.gycs.b.yahoodns.net. (55)</span><br><span class="line">IP 172.31.30.115.48965 &gt; 192.35.51.30.domain: 16552% [1au] A? e2p-v4.gycs.b.yahoodns.net. (55)</span><br><span class="line">IP 192.35.51.30.domain &gt; 172.31.30.115.45512: 2908- 0/9/9 (803)</span><br><span class="line">IP 192.35.51.30.domain &gt; 172.31.30.115.48965: 16552- 0/9/9 (803)</span><br><span class="line">IP 172.31.30.115.20105 &gt; 68.142.255.16.domain: 16315% [1au] AAAA? e2p-v4.gycs.b.yahoodns.net. (55)</span><br><span class="line">IP 172.31.30.115.29503 &gt; 68.142.255.16.domain: 50107% [1au] A? e2p-v4.gycs.b.yahoodns.net. (55)</span><br><span class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.20105: 16315- 0/4/3 (179)</span><br><span class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.29503: 50107- 0/4/3 (179)</span><br><span class="line">IP 172.31.30.115.44871 &gt; 68.180.130.15.domain: 45208% [1au] AAAA? e2p-v4.gycs.b.yahoodns.net. (55)</span><br><span class="line">IP 172.31.30.115.11781 &gt; 68.180.130.15.domain: 48190% [1au] A? e2p-v4.gycs.b.yahoodns.net. (55)</span><br><span class="line">IP 68.180.130.15.domain &gt; 172.31.30.115.44871: 45208*- 0/1/1 (125)</span><br><span class="line">IP 68.180.130.15.domain &gt; 172.31.30.115.11781: 48190*- 4/0/1 A 69.147.92.14, A 69.147.82.57, A 69.147.82.56, A 69.147.92.13 (119)</span><br><span class="line">IP 172.31.30.115.59783 &gt; 192.35.51.30.domain: 13560% [1au] DS? yahoodns.net. (41)</span><br><span class="line">IP 192.35.51.30.domain &gt; 172.31.30.115.59783: 13560*- 0/6/1 (762)</span><br><span class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.32918: 35896 5/4/2 CNAME e2p-v4.gycs.b.yahoodns.net., A 69.147.82.57, A 69.147.92.13, A 69.147.82.56, A 69.147.92.14 (257)</span><br><span class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.32918: 2913 1/1/0 CNAME e2p-v4.gycs.b.yahoodns.net. (139)</span><br></pre></td></tr></table></figure>

<p>I found before the ‘telnet’ running in the client, my client sent some PTR requests for ‘1.16.31.172.in-addr.arpa’ and ‘218.24.13.126.in-addr.arpa’. The former looks loke the AWS internal IP address(private address).And my client also ask address for ‘softbank126013024218.bbtec.net’. These behaviors make me feel puzzled.<br>My client sent request to server for ‘<a target="_blank" rel="noopener" href="http://www.tumblr.com/">www.tumblr.com</a>‘. Then server will search its CNAME and ip address, and return the result to my client.</p>
<h2 id="Third-scenarios"><a href="#Third-scenarios" class="headerlink" title="Third scenarios"></a>Third scenarios</h2><p>For example, I perform a reverse host look up for ‘104.244.42.193’ which not yet in my DNS server’s cache.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 t]<span class="comment"># tcpdump -w tcpdump.out port not 22 &amp;</span></span><br><span class="line">[1] 19863</span><br><span class="line">[root@ip-172-31-30-115 t]<span class="comment"># tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</span></span><br><span class="line">arp -d -a</span><br><span class="line">gateway (172.31.16.1) at 0e:8a:cb:2d:0b:70 [ether] on eth0</span><br><span class="line">[root@ip-172-31-30-115 t]<span class="comment"># dig -x 104.244.42.193</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-38.el7_3.2 &lt;&lt;&gt;&gt; -x 104.244.42.193</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: SERVFAIL, id: 14873</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 4096</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;193.42.244.104.in-addr.arpa.	IN	PTR</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 20 msec</span></span><br><span class="line"><span class="string">;; SERVER: 127.0.0.1#53(127.0.0.1)</span></span><br><span class="line"><span class="string">;; WHEN: Sun Mar 19 20:45:42 EDT 2017</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 56</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@ip-172-31-30-115 t]# kill %1</span></span><br><span class="line"><span class="string">[root@ip-172-31-30-115 t]# 30 packets captured</span></span><br><span class="line"><span class="string">30 packets received by filter</span></span><br><span class="line"><span class="string">0 packets dropped by kernel</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[1]+  Done                    tcpdump -w tcpdump.out port not 22</span></span><br></pre></td></tr></table></figure>
<p>Result:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 t]<span class="comment"># tcpdump -t -n -r tcpdump.out udp port 53</span></span><br><span class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</span><br><span class="line">IP 172.31.30.115.13797 &gt; 199.253.183.183.domain: 18802% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP 199.253.183.183.domain &gt; 172.31.30.115.13797: 18802- 0/8/1 (387)</span><br><span class="line">IP 172.31.30.115.10452 &gt; 199.180.180.63.domain: 62185% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP 199.180.180.63.domain &gt; 172.31.30.115.10452: 62185- 0/6/1 (363)</span><br><span class="line">IP 172.31.30.115.44763 &gt; 162.88.61.21.domain: 55611% [1au] A? ns1.p34.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.36069 &gt; 162.88.61.21.domain: 34433% [1au] AAAA? ns1.p34.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.atmtcp &gt; 162.88.61.21.domain: 27190% [1au] A? ns2.p34.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.56824 &gt; 162.88.61.21.domain: 1127% [1au] AAAA? ns2.p34.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.44520 &gt; 162.88.61.21.domain: 22087% [1au] A? ns3.p34.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.9172 &gt; 162.88.61.21.domain: 9046% [1au] AAAA? ns3.p34.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.8847 &gt; 162.88.61.21.domain: 31946% [1au] A? ns4.p34.dynect.net. (47)</span><br><span class="line">IP 172.31.30.115.16122 &gt; 162.88.61.21.domain: 60963% [1au] AAAA? ns4.p34.dynect.net. (47)</span><br><span class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.atmtcp: 27190*- 1/0/1 A 204.13.250.34 (63)</span><br><span class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.56824: 1127*- 0/1/1 (131)</span><br><span class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.44520: 22087*- 1/0/1 A 208.78.71.34 (63)</span><br><span class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.9172: 9046*- 1/0/1 AAAA 2001:500:94:1::34 (75)</span><br><span class="line">IP 172.31.30.115.30710 &gt; 204.13.250.34.domain: 35918% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.44763: 55611*- 1/0/1 A 208.78.70.34 (63)</span><br><span class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.16122: 60963*- 0/1/1 (131)</span><br><span class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.36069: 34433*- 1/0/1 AAAA 2001:500:90:1::34 (75)</span><br><span class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.8847: 31946*- 1/0/1 A 204.13.251.34 (63)</span><br><span class="line">IP 204.13.250.34.domain &gt; 172.31.30.115.30710: 35918 Refused- 0/0/1 (56)</span><br><span class="line">IP 172.31.30.115.38732 &gt; 208.78.71.34.domain: 17860% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP 208.78.71.34.domain &gt; 172.31.30.115.38732: 17860 Refused- 0/0/1 (56)</span><br><span class="line">IP 172.31.30.115.31531 &gt; 204.13.251.34.domain: 16321% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP 204.13.251.34.domain &gt; 172.31.30.115.31531: 16321 Refused- 0/0/1 (56)</span><br><span class="line">IP 172.31.30.115.53208 &gt; 208.78.70.34.domain: 33024% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP 208.78.70.34.domain &gt; 172.31.30.115.53208: 33024 Refused- 0/0/1 (56)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-30-115 t]<span class="comment"># tcpdump -t  -r tcpdump.out udp port 53</span></span><br><span class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.13797 &gt; b.in-addr-servers.arpa.domain: 18802% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP b.in-addr-servers.arpa.domain &gt; ip-172-31-30-115.ec2.internal.13797: 18802- 0/8/1 (387)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.10452 &gt; r.arin.net.domain: 62185% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP r.arin.net.domain &gt; ip-172-31-30-115.ec2.internal.10452: 62185- 0/6/1 (363)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.44763 &gt; ns6.dynamicnetworkservices.net.domain: 55611% [1au] A? ns1.p34.dynect.net. (47)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.36069 &gt; ns6.dynamicnetworkservices.net.domain: 34433% [1au] AAAA? ns1.p34.dynect.net. (47)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.atmtcp &gt; ns6.dynamicnetworkservices.net.domain: 27190% [1au] A? ns2.p34.dynect.net. (47)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.56824 &gt; ns6.dynamicnetworkservices.net.domain: 1127% [1au] AAAA? ns2.p34.dynect.net. (47)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.44520 &gt; ns6.dynamicnetworkservices.net.domain: 22087% [1au] A? ns3.p34.dynect.net. (47)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.9172 &gt; ns6.dynamicnetworkservices.net.domain: 9046% [1au] AAAA? ns3.p34.dynect.net. (47)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.8847 &gt; ns6.dynamicnetworkservices.net.domain: 31946% [1au] A? ns4.p34.dynect.net. (47)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.16122 &gt; ns6.dynamicnetworkservices.net.domain: 60963% [1au] AAAA? ns4.p34.dynect.net. (47)</span><br><span class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.atmtcp: 27190*- 1/0/1 A 204.13.250.34 (63)</span><br><span class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.56824: 1127*- 0/1/1 (131)</span><br><span class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.44520: 22087*- 1/0/1 A 208.78.71.34 (63)</span><br><span class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.9172: 9046*- 1/0/1 AAAA 2001:500:94:1::34 (75)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.30710 &gt; ns2.p34.dynect.net.domain: 35918% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.44763: 55611*- 1/0/1 A 208.78.70.34 (63)</span><br><span class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.16122: 60963*- 0/1/1 (131)</span><br><span class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.36069: 34433*- 1/0/1 AAAA 2001:500:90:1::34 (75)</span><br><span class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.8847: 31946*- 1/0/1 A 204.13.251.34 (63)</span><br><span class="line">IP ns2.p34.dynect.net.domain &gt; ip-172-31-30-115.ec2.internal.30710: 35918 Refused- 0/0/1 (56)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.38732 &gt; ns3.p34.dynect.net.domain: 17860% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP ns3.p34.dynect.net.domain &gt; ip-172-31-30-115.ec2.internal.38732: 17860 Refused- 0/0/1 (56)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.31531 &gt; ns4.p34.dynect.net.domain: 16321% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP ns4.p34.dynect.net.domain &gt; ip-172-31-30-115.ec2.internal.31531: 16321 Refused- 0/0/1 (56)</span><br><span class="line">IP ip-172-31-30-115.ec2.internal.53208 &gt; ns1.p34.dynect.net.domain: 33024% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</span><br><span class="line">IP ns1.p34.dynect.net.domain &gt; ip-172-31-30-115.ec2.internal.53208: 33024 Refused- 0/0/1 (56)</span><br></pre></td></tr></table></figure>

<p>My server communicate with these name servers:</p>
<p>199.253.183.183			b.in-addr-servers.arpa<br>199.180.180.63			r.arin.net<br>162.88.61.21			ns6.dynamicnetworkservices 	</p>
<p>These servers aren’t the root servers. And I also use ‘whois’ try to find their operators, but there isn’t any message about them.</p>
</article><div class="post-copyright"><div class="post-copyright__author_group"><a class="post-copyright__author_img" href="/about/"><img class="post-copyright__author_img_front" src="/img/pwa/favicon.png"></a><div class="post-copyright__author_name">Ankai Liang's Blog</div><div class="post-copyright__author_desc">Strong but not aggressive, weak but not feeble.</div></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div id="quit-box" onclick="RemoveRewardMask()"></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">This piece of writing is an original article, utilizing the<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>Agreement. For complete reproduction, please acknowledge the source as Courtesy of<a href="/">Ankai Liang's Blog</a></span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/System-Administration/"><span class="tags-punctuation"></span>System Administration<span class="tagsPageCount">6</span></a></div></div></div><nav class="needEndHide pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2017/08/17/afewmore-A-tool-of-ec2-how-to-write-a-shell-tool/"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">afewmore</div></div></a></div><div class="next-post pull-right"><a href="/2017/08/16/Using-Manages-packages-in-Linux/"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Using Manages packages in Linux</div></div></a></div></nav><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="solitude st-chat-fill"></i><span> Comment</span><span></span></div></div><div class="comment-wrap"><div id="comment"></div><script>async function initComment() {
    const isLazyLoad = !true;
    let walineInitFunction = window.walineFn || null;

    async function initWaline(Fn) {
        const walineOptions = {
            el: '#comment',
            serverURL: 'https://waline-comment-b9nz6bbxt-ankailiangs-projects.vercel.app/',
            pageview: !isLazyLoad,
            dark: 'html[data-theme="dark"]',
            path: window.location.pathname,
            comment: !isLazyLoad,
            ...null
        };
        const walineInstance = Fn(walineOptions);

        utils.addGlobalFn('pjax', () => walineInstance.destroy(), 'destroyWaline');
    }

    async function loadWalineCSSAndJS() {
        if (!walineInitFunction) {
            await getCSS('https://cdn.staticfile.net/waline/3.1.3/waline.min.css');
            const {init} = await import('https://cdn.staticfile.net/waline/3.1.3/waline.min.js');
            walineInitFunction = init || Waline.init;
            window.walineFn = walineInitFunction;
        }
        initWaline(walineInitFunction);
    }

    if (isLazyLoad) {
        utils.loadComment(document.getElementById('comment'),loadWalineCSSAndJS);
    } else {
        await loadWalineCSSAndJS();
    }

    if (GLOBAL_CONFIG.lightbox) {
        utils.lightbox(document.querySelectorAll('#comment .wl-content img:not(.wl-emoji)'));
    }

    sco.owoBig();
}</script></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><div class="author-info__top-group"><div class="author-info__sayhi" id="author-info__sayhi" onclick="sco.changeSayHelloText()">sayhello.morning</div></div></div><div class="avatar-img-group"><img class="avatar-img" alt="Avatar" src="/img/avatar.png"><div class="avatar-sticker"><img class="avatar-sticker-img" src="https://7.isyangs.cn/34/65f2e4e0423cc-34.png" alt="Mood sticker"></div></div><div class="author-info__description_group"><div class="author-info__description">Share my <b>passion</b> for programming, <b>aspiration</b> for a better life, and <b>journey</b> of exploring the ocean of knowledge.</div><div class="author-info__description2"></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about/"><div class="author-info__name">Ankai Liang</div><div class="author-info__desc">Strong but not aggressive, weak but not feeble.</div></a><div class="card-info-social-icons is-center"><a class="social-icon" target="_blank" rel="noopener" href="https://github.com/ankaiLiang" title="Github"><i class="solitude  st-github-line"></i></a><a class="social-icon" target="_blank" rel="noopener" href="https://www.instagram.com/ankai_liang/" title="Instagram"><i class="solitude  st-image-fill"></i></a><a class="social-icon" target="_blank" rel="noopener" href="https://www.linkedin.com/in/ankai-liang-a774b3119?trk=hp-identity-name" title="LinkedIn"><i class="solitude  st-contacts-fill"></i></a><a class="social-icon" target="_blank" rel="noopener" href="https://www.facebook.com/lakeandgod" title="Facebook"><i class="solitude  st-contacts-fill"></i></a><a class="social-icon" target="_blank" rel="noopener" href="http://weibo.com/1783077873/profile?rightmod=1&amp;wvr=6&amp;mod=personnumber" title="weibo"><i class="solitude  st-contacts-fill"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="solitude st-menu-line"></i><span>Table of contents</span></div><div class="toc-content" id="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Description"><span class="toc-text">Description</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Objective"><span class="toc-text">Objective</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OS-Instances"><span class="toc-text">OS Instances</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS-server-setup"><span class="toc-text">DNS server setup</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Content"><span class="toc-text">Content</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Set-up-a-caching-name-server"><span class="toc-text">Set up a caching name server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-a-instance-of-Red-Hat"><span class="toc-text">Create a instance of Red Hat.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-package-bind-bind-utils-and-caching-nameserver"><span class="toc-text">Install package bind, bind-utils and caching-nameserver.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Modify-the-file-%E2%80%98-etc-named-conf%E2%80%99"><span class="toc-text">Modify the file ‘&#x2F;etc&#x2F;named.conf’</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Look-the-file-%E2%80%98named-ca%E2%80%99"><span class="toc-text">Look the file ‘named.ca’:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Modify-the-file-%E2%80%98etc-resolv-conf%E2%80%99"><span class="toc-text">Modify the file ‘etc&#x2F;resolv.conf’:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deploy-the-Cache-only-DNS-server-within-chroot-environment"><span class="toc-text">Deploy the Cache-only DNS server within chroot environment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Start-the-named-server"><span class="toc-text">Start the named server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configured-the-client"><span class="toc-text">Configured the client</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-an-instance-as-our-client"><span class="toc-text">Create an instance as our client</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcpdump-exercises"><span class="toc-text">tcpdump exercises</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#First-scenario"><span class="toc-text">First scenario</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Install-telnet-and-tcpdump"><span class="toc-text">Install telnet and tcpdump</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-tcpdump-to-record-package-information"><span class="toc-text">Set tcpdump to record package information</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Yahoo%E2%80%99s-authoritative-DNS-servers"><span class="toc-text">Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Yahoo’s authoritative DNS servers.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Identify-the-3-way-handshake-that-initiates-the-connection-from-your-DNS-server-to-port-80-on-Yahoo%E2%80%99s-webserver-the-packets-that-are-being-sent-back-and-forth-and-finally-the-closing-of-the-connection"><span class="toc-text">Identify the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver, the packets that are being sent back and forth and finally the closing of the connection.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Second-scenarios"><span class="toc-text">Second scenarios</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-tcpdump-and-telnet-on-client-the-same-step-as-first-scenarios"><span class="toc-text">Install tcpdump and telnet on client (the same step as first scenarios.)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-tcpdump-to-listen"><span class="toc-text">Set tcpdump to listen</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run-telnet"><span class="toc-text">Run telnet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Track-down-the-packets-in-tcpdump-referring-to-the-DNS-query-from-your-client-host-to-DNS-server"><span class="toc-text">Track down the packets in tcpdump referring to the DNS query from your client host to DNS server.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Tumblr%E2%80%99s-authoritative-DNS-servers"><span class="toc-text">Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Tumblr’s authoritative DNS servers.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Third-scenarios"><span class="toc-text">Third scenarios</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="solitude st-map-line"></i><span>New posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/17/Semi-Structured-Search/" title="Semi-Structured Search"><img alt="Semi-Structured Search" src="/img/default4.png"></a><div class="content"><a class="title" href="/2023/08/17/Semi-Structured-Search/" title="Semi-Structured Search">Semi-Structured Search</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/2017/08/17/DHT-REMOTE/" title="DHT-REMOTE"><img alt="DHT-REMOTE" src="/img/default3.png"></a><div class="content"><a class="title" href="/2017/08/17/DHT-REMOTE/" title="DHT-REMOTE">DHT-REMOTE</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/2017/08/17/Page-Rank-Hadoop/" title="Page Rank - Hadoop"><img alt="Page Rank - Hadoop" src="/img/default3.png"></a><div class="content"><a class="title" href="/2017/08/17/Page-Rank-Hadoop/" title="Page Rank - Hadoop">Page Rank - Hadoop</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/2017/08/17/RushHour/" title="RushHour"><img alt="RushHour" src="/img/default5.png"></a><div class="content"><a class="title" href="/2017/08/17/RushHour/" title="RushHour">RushHour</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/2017/08/17/Text-processing-in-Linux/" title="Text-processing"><img alt="Text-processing" src="/img/default5.png"></a><div class="content"><a class="title" href="/2017/08/17/Text-processing-in-Linux/" title="Text-processing">Text-processing</a></div></div></div></div></div></div></main><footer id="footer"><div id="st-footer-bar"><div class="footer-logo"><span class="solitude">Ankai Liang / ex-Googler / ByteDancer</span></div><div class="footer-bar-description">Article from Ankai Liang's Blog - Strong but not aggressive, weak but not feeble.</div><a class="footer-bar-link" href="/">Learn more</a></div><div id="footer_deal"><div class="nolazyload footer_mini_logo" id="footer_mini_logo" title="Back to top" onclick="sco.toTop()"><img src="/img/pwa/favicon.png" alt="Back to top"></div></div><div id="st-footer"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div class="copyright">© 2023 - 2024 By&nbsp;<a class="footer-bar-link" href="/">Ankai Liang</a></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/valor-x/hexo-theme-solitude" title="主题">主题</a><a class="footer-bar-link cc" href="/null" aria-label="copyright"><i class="solitude st-copyright-line"></i><i class="solitude st-creative-commons-by-line"></i><i class="solitude st-creative-commons-nc-line"></i><i class="solitude st-creative-commons-nd-line"></i></a></div></div></div></footer></div><!-- inject body--><div><script src="/js/main.js?v=1.7.8"></script><script src="/js/utils.js?v=1.7.8"></script><script src="/js/third_party/universe.min.js?v=1.7.8"></script><script>dark()
</script><script src="https://cdn.staticfile.net/pjax/0.2.8/pjax.min.js"></script><script src="https://cdn.staticfile.net/node-snackbar/0.1.16/snackbar.min.js"></script><script src="/js/third_party/efu_ai.min.js?v=1.7.8"></script><script src="https://cdn.staticfile.net/pace/1.2.4/pace.min.js"></script></div><div id="js-pjax"><script id="config-diff">var PAGE_CONFIG = {
    is_post: true,
    is_page: false,
    is_home: false,
    page: 'post',
    toc: true,
    comment: true,
}
</script></div><!-- newest comment--><!-- pjax--><script>let pjaxSelectors = [
    'title',
    '#body-wrap',
    '#site-config',
    'meta[name="description"]',
    '#js-pjax',
    'meta[property^="og:"]',
]

const pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
})

document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
})

document.addEventListener('pjax:complete', () => {
    window.refreshFn()
})

document.addEventListener('pjax:error', (e) => {
    if (e.request.status === 404) {
        pjax.loadUrl('/404.html')
    }
})</script><!-- theme--><script>initTheme = () => {
    let isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const cachedMode = saveToLocal.get('theme');
    if (cachedMode === undefined) {
        const nowMode =
            isDarkMode ? 'dark' : 'light'
        document.documentElement.setAttribute('data-theme', nowMode);
    } else {
        document.documentElement.setAttribute('data-theme', cachedMode);
    }
}
initTheme()</script><!-- google adsense--><!-- search--><!-- music--></body></html><script>const posts=["2023/08/17/Semi-Structured-Search/","2017/08/17/DHT-REMOTE/","2017/08/17/Page-Rank-Hadoop/","2017/08/17/RushHour/","2017/08/17/Text-processing-in-Linux/","2017/08/17/afewmore-A-tool-of-ec2-how-to-write-a-shell-tool/","2017/08/16/tcpdump-1-DNS/","2017/08/16/Using-Manages-packages-in-Linux/","2017/08/16/Using-the-AWS-CLI-to-set-instance/","2017/05/19/Install and Configure AWS Tools/"];function toRandomPost(){ pjax.loadUrl('/'+posts[Math.floor(Math.random()*posts.length)]); }</script>